<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-list-page plugin-blog plugin-id-default">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.3.1">
<title data-rh="true">Blog | Navigating Blocks and Chains</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://harz.dev/img/header.jpg"><meta data-rh="true" name="twitter:image" content="https://harz.dev/img/header.jpg"><meta data-rh="true" property="og:url" content="https://harz.dev/blog"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" property="og:title" content="Blog | Navigating Blocks and Chains"><meta data-rh="true" name="description" content="Blog"><meta data-rh="true" property="og:description" content="Blog"><meta data-rh="true" name="docusaurus_tag" content="blog_posts_list"><meta data-rh="true" name="docsearch:docusaurus_tag" content="blog_posts_list"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://harz.dev/blog"><link data-rh="true" rel="alternate" href="https://harz.dev/blog" hreflang="en"><link data-rh="true" rel="alternate" href="https://harz.dev/blog" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Navigating Blocks and Chains RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Navigating Blocks and Chains Atom Feed">



<link rel="preconnect" href="https://harz_dev.goatcounter.com">
<script async src="//gc.zgo.at/count.js" data-goatcounter="https://harz_dev.goatcounter.com/count"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.24/dist/katex.min.css" integrity="sha384-odtC+0UGzzFL/6PNoE8rX/SPcQDXBJ+uRepguP4QkPCm2LBxH3FA3y+fKSiJ+AmM" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.ebb0c0da.css">
<link rel="preload" href="/assets/js/runtime~main.82fdd56c.js" as="script">
<link rel="preload" href="/assets/js/main.4f748605.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"dark")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><b class="navbar__title text--truncate">Home</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">Blog</a><a class="navbar__item navbar__link" href="/publications">Publications</a><a class="navbar__item navbar__link" href="/contact">Contact</a></div><div class="navbar__items navbar__items--right"><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently dark mode)" aria-label="Switch between dark and light mode (currently dark mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">All posts</div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/rust-verification">Verifying Rust: Exploring Verification Options for Substrate</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/lean-execution">Lean Execution: How to Stay Focused</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/maker-collateral-attack">Stealing All of Maker&#x27;s Collateral</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/analysing-ethereum-gas-cost">Analysing Ethereum contract gas costs during development</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/bitcoin-smart-contracts-mechanism-design">Analyzing Bitcoin smart contracts from a mechanism design perspective</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/ethereum-python-integration">Integrating Python and Ethereum</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/quantitative-finance-zipline">Quantitative finance with zipline</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/breaking-captchas">Breaking captchas: Using deep learning to automatically break CAPTCHAs</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/dinvest-hedge-fund-on-a-blockchain">dInvest - hedge fund on a blockchain</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/rust-verification">Verifying Rust: Exploring Verification Options for Substrate</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2023-02-20T00:00:00.000Z" itemprop="datePublished">February 20, 2023</time> · <!-- -->7 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://harz.dev" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/nud3l.png" alt="Dominik Harz"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://harz.dev" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Dominik Harz</span></a></div><small class="avatar__subtitle" itemprop="description">CTO Interlay</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>Security is hard to get right in blockchains. It&#x27;s even harder to make sure that code is correct while still actively developing the product: code changes are frequent, requirements are changing, and the codebase is growing.</p><p>In this post, we&#x27;ll explore options for verifying blockchain code, specifically for the Substrate blockchain framework to try to verify the code of the <a href="https://www.github.com/interlay/interbtc" target="_blank" rel="noopener noreferrer">Interlay blockchain</a>. </p><p>My requirements for the test were simple: the tool should be integrated into the Rust toolchain (no DSLs) and I set myself a time limit of a single day to get started and get a useful result.</p><p>Spoiler alert: I managed to get two tools running and produce output. This post covers only the setup and I will follow up with more details in a future post.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="substrate-runtimes-as-verification-targets">Substrate Runtimes as Verification Targets<a href="#substrate-runtimes-as-verification-targets" class="hash-link" aria-label="Direct link to Substrate Runtimes as Verification Targets" title="Direct link to Substrate Runtimes as Verification Targets">​</a></h2><p>We are building the <a href="https://interlay.io" target="_blank" rel="noopener noreferrer">Interlay</a> and Kintsugi blockchains based on the Rust <a href="https://substrate.dev" target="_blank" rel="noopener noreferrer">Substrate</a> framework.
For verifying that the &quot;code is correct&quot;, we are looking for two targets:</p><ol><li><strong>Runtime</strong>: The WASM runtime encodes the rules of the blockchain subject to consensus verification. This is where we can potentially introduce logical errors in how the protocols are working or in their implementation such that we either impact the <em>safety</em> or <em>liveness</em> of the system.</li><li><strong>Node Implementation</strong>: The node implementation wraps around the runtime. Bugs introduced here can impact the <em>liveness</em> of the system.</li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="diving-into-verification">Diving into Verification<a href="#diving-into-verification" class="hash-link" aria-label="Direct link to Diving into Verification" title="Direct link to Diving into Verification">​</a></h2><p>Software verification is most often quite an academic exercise. With the adverse environment of blockchain development, there&#x27;s a clear benefit of increased security assurance in the software development process.
This goes hand in hand with the <a href="https://alastairreid.github.io/papers/HATRA_20/" target="_blank" rel="noopener noreferrer">desire of the verification community to integrate verification into the development process</a>.</p><p>I&#x27;ll not cover the usual testing and fuzzing tools but rather explore the three tools I found most accessible for verification in Rust.</p><p>My criteria for selecting tools were:</p><ol><li><strong>Actively maintained</strong>: The tool should be actively maintained and have a community around it. I checked the GitHub repositories for current contributions and when the last commit was made.</li><li><strong>Clear documentation</strong>: The tool should have clear documentation on how to use it and get started. If after 10 minutes of parsing the available documentation, I could not get a good understanding of how to install or use the tool, I would not use it.</li><li><strong>Rust integration</strong>: Since the idea is to integrate the tool into the normal development workflow, I was looking for a tool that integrates well with <code>cargo</code> and also does not require writing verification code in a language other than Rust.</li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="selected-tools">Selected Tools<a href="#selected-tools" class="hash-link" aria-label="Direct link to Selected Tools" title="Direct link to Selected Tools">​</a></h2><p>From the tools I found, I selected the following three tools for further exploration:</p><ul><li><a href="https://github.com/model-checking/kani" target="_blank" rel="noopener noreferrer">kani</a></li><li><a href="https://viperproject.github.io/prusti-dev/" target="_blank" rel="noopener noreferrer">Prusti</a></li><li><a href="https://github.com/facebookexperimental/MIRAI" target="_blank" rel="noopener noreferrer">MIRAI</a></li></ul><p>More tools are available on the <a href="https://rust-formal-methods.github.io/tools.html" target="_blank" rel="noopener noreferrer">Rust Formal Methods Interest Group</a> website and on <a href="https://alastairreid.github.io/automatic-rust-verification-tools-2021/" target="_blank" rel="noopener noreferrer">Alastair Reid&#x27;s blog</a>.</p><p>For all tools, I installed them and ran them without any additional configuration against the <a href="https://github.com/interlay/interbtc" target="_blank" rel="noopener noreferrer">chain implementation</a> of the Interlay blockchain.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="a-note-on-expectations">A Note on Expectations<a href="#a-note-on-expectations" class="hash-link" aria-label="Direct link to A Note on Expectations" title="Direct link to A Note on Expectations">​</a></h3><p>I would be happy if a tool runs on the first try: installing the tool without issues and scanning the code base without setting up verification rules. Overall, the code is well-tested, but it is very complex: more than 1,000 dependencies, almost 100,000 lines of code, and invoking external C libraries.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="kani">kani<a href="#kani" class="hash-link" aria-label="Direct link to kani" title="Direct link to kani">​</a></h2><p>From the <a href="https://model-checking.github.io/kani/getting-started.html" target="_blank" rel="noopener noreferrer">developer&#x27;s website</a>:</p><blockquote><p>Kani is an open-source verification tool that uses model checking to analyze Rust programs. Kani is particularly useful for verifying unsafe code in Rust, where many of the Rust’s usual guarantees are no longer checked by the compiler.</p></blockquote><h3 class="anchor anchorWithStickyNavbar_LWe7" id="getting-started">Getting started<a href="#getting-started" class="hash-link" aria-label="Direct link to Getting started" title="Direct link to Getting started">​</a></h3><p>I found getting started very easy with just two commands to execute:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">cargo </span><span class="token function" style="color:rgb(80, 250, 123)">install</span><span class="token plain"> --locked kani-verifier</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">cargo kani setup</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Next, I ran kani against the runtime of the Interlay blockchain:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)"># From the interbtc repo root</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">cargo kani</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="compilation-errors">Compilation Errors<a href="#compilation-errors" class="hash-link" aria-label="Direct link to Compilation Errors" title="Direct link to Compilation Errors">​</a></h3><p>That produced the following error during the compilation of the <code>schnorrkel</code> crate:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">error: </span><span class="token function" style="color:rgb(80, 250, 123)">format</span><span class="token plain"> argument must be a string literal</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   --</span><span class="token operator">&gt;</span><span class="token plain"> /home/nud3l/.cargo/registry/src/github.com-1ecc6299db9ec823/schnorrkel-0.9.1/src/batch.rs:165:47</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token number">165</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">     assert</span><span class="token operator">!</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">hrams.len</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">==</span><span class="token plain"> public_keys.len</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain">, ASSERT_MESSAGE</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token operator">|</span><span class="token plain">                                               ^^^^^^^^^^^^^^</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">help: you might be missing a string literal to </span><span class="token function" style="color:rgb(80, 250, 123)">format</span><span class="token plain"> with</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token number">165</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">     assert</span><span class="token operator">!</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">hrams.len</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">==</span><span class="token plain"> public_keys.len</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain">, </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;{}&quot;</span><span class="token plain">, ASSERT_MESSAGE</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token operator">|</span><span class="token plain">                                               +++++</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>At this point, I wasn&#x27;t sure how to convince kani to ignore these errors in the dependencies. I tried running kani only on a single crate but it resulted in the same compiler issue.</p><p>The authors have a guide on how to get started with <a href="https://model-checking.github.io/kani/tutorial-real-code.html" target="_blank" rel="noopener noreferrer">real code</a> but it does not include how to handle compiler errors in dependencies.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="prusti">Prusti<a href="#prusti" class="hash-link" aria-label="Direct link to Prusti" title="Direct link to Prusti">​</a></h2><p>From the <a href="https://viperproject.github.io/prusti-dev/" target="_blank" rel="noopener noreferrer">developer&#x27;s website</a>:</p><blockquote><p>Prusti is a verification tool for Rust programs. It is based on the Rust compiler and uses the Rust type system to verify Rust programs. Prusti is a research prototype and is not yet ready for production use.</p></blockquote><h3 class="anchor anchorWithStickyNavbar_LWe7" id="getting-started-1">Getting started<a href="#getting-started-1" class="hash-link" aria-label="Direct link to Getting started" title="Direct link to Getting started">​</a></h3><p>Getting started with Prusti required downloading the Prusti Assistant VS Code extension.
I already had the required Java SDk and <code>rustup</code> versions installed so the process of getting started only involved opening a rust file and hitting the &quot;Verify with Prusti&quot; button on the VS Code status bar.</p><p><img loading="lazy" alt="Prusti" src="/assets/images/prusti-03fc7621aaa000baec571b5bb93e5210.png" width="774" height="1079" class="img_ev3q"></p><p>As the first target, the <a href="https://github.com/interlay/interbtc/blob/master/crates/fee/src/lib.rs" target="_blank" rel="noopener noreferrer">fee pallet</a> seemed interesting as it&#x27;s mildly complex, has few dependencies, and with its fixed point math might be subject to issues.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="errors">Errors<a href="#errors" class="hash-link" aria-label="Direct link to Errors" title="Direct link to Errors">​</a></h3><p>On the first run on the fee crate, Prusti found 358 errors. That seemed quite a lot but after initial inspection, most of the errors were:</p><ul><li>Unsupported features (313 errors): I was expecting Prusti with its <a href="https://viperproject.github.io/prusti-dev/user-guide/verify/summary.html" target="_blank" rel="noopener noreferrer">current feature set</a> to run into these issues as substrate makes heavy use of macros, traits, and other advanced features of Rust.</li><li>Internal errors (24 errors): Several internal errors occured.</li><li>Unexpected verification error (9 errors): Some verification failed.</li><li>Verification errors (14 errors): These seem to be the ones worth investigating.</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="success">Success<a href="#success" class="hash-link" aria-label="Direct link to Success" title="Direct link to Success">​</a></h3><p>Prusti found potential overflow and underflow errors in the bitcoin crate:</p><div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">// bitcoin/src/parser.rs</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> position </span><span class="token operator">+</span><span class="token plain"> </span><span class="token number">4</span><span class="token plain"> </span><span class="token operator">&gt;</span><span class="token plain"> raw_bytes</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">len</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> </span><span class="token class-name">Err</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token class-name">Error</span><span class="token punctuation" style="color:rgb(248, 248, 242)">::</span><span class="token class-name">EndOfFile</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>It also found possible issues with unbounded arrays:</p><div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">// bitcoin/src/script.rs</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">pub</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:rgb(80, 250, 123)">op_return</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">return_content</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token operator">&amp;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">u8</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-&gt;</span><span class="token plain"> </span><span class="token class-name">Script</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">let</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">mut</span><span class="token plain"> script </span><span class="token operator">=</span><span class="token plain"> </span><span class="token class-name">Script</span><span class="token punctuation" style="color:rgb(248, 248, 242)">::</span><span class="token function" style="color:rgb(80, 250, 123)">new</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    script</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">append</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token class-name">OpCode</span><span class="token punctuation" style="color:rgb(248, 248, 242)">::</span><span class="token class-name">OpReturn</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    script</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">append</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">return_content</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">len</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">u8</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    script</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">append</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">return_content</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    script</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="mirai">MIRAI<a href="#mirai" class="hash-link" aria-label="Direct link to MIRAI" title="Direct link to MIRAI">​</a></h2><p>From the <a href="https://github.com/facebookexperimental/MIRAI" target="_blank" rel="noopener noreferrer">developer&#x27;s website</a>:</p><blockquote><p>MIRAI is an abstract interpreter for the Rust compiler&#x27;s mid-level intermediate representation (MIR). It is intended to become a widely used static analysis tool for Rust.</p></blockquote><h3 class="anchor anchorWithStickyNavbar_LWe7" id="getting-started-2">Getting started<a href="#getting-started-2" class="hash-link" aria-label="Direct link to Getting started" title="Direct link to Getting started">​</a></h3><p>Installation of MIRAI was straightforward, following the <a href="https://github.com/facebookexperimental/MIRAI/blob/main/documentation/InstallationGuide.md" target="_blank" rel="noopener noreferrer">guide</a>:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token function" style="color:rgb(80, 250, 123)">git</span><span class="token plain"> clone https://github.com/facebookexperimental/MIRAI.git</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">cd</span><span class="token plain"> MIRAI</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">cargo </span><span class="token function" style="color:rgb(80, 250, 123)">install</span><span class="token plain"> --locked --path ./checker</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Next, I ran MIRAI in the interbtc root directory.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">cargo mirai</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="compilation-errors-1">Compilation Errors<a href="#compilation-errors-1" class="hash-link" aria-label="Direct link to Compilation Errors" title="Direct link to Compilation Errors">​</a></h3><p>MIRAI produces compilation errors on the wasm builds:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">     Compiling wasm-test v1.0.0 </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">/tmp/.tmpfNz4QS</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  error</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">E0463</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain">: can&#x27;t </span><span class="token function" style="color:rgb(80, 250, 123)">find</span><span class="token plain"> crate </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">for</span><span class="token plain"> </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">`</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">std</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token operator">=</span><span class="token plain"> note: the </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">`</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">wasm32-unknown-unknown</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">`</span><span class="token plain"> target may not be installed</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token operator">=</span><span class="token plain"> help: consider downloading the target with </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">`</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">rustup target </span><span class="token variable function" style="color:rgb(80, 250, 123);font-style:italic">add</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic"> wasm32-unknown-unknown</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token operator">=</span><span class="token plain"> help: consider building the standard library from </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">source</span><span class="token plain"> with </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">`</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">cargo build -Zbuild-std</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  error: requires </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">`</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">sized</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">`</span><span class="token plain"> lang_item</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  For </span><span class="token function" style="color:rgb(80, 250, 123)">more</span><span class="token plain"> information about this error, try </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">`</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">rustc --explain E0463</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">`</span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  error: could not compile </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">`</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">wasm-test</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">`</span><span class="token plain"> due to </span><span class="token number">2</span><span class="token plain"> previous errors</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  warning: build failed, waiting </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">for</span><span class="token plain"> other </span><span class="token function" style="color:rgb(80, 250, 123)">jobs</span><span class="token plain"> to finish</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  error: cannot </span><span class="token function" style="color:rgb(80, 250, 123)">find</span><span class="token plain"> macro </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">`</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">println</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">in</span><span class="token plain"> this scope</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   --</span><span class="token operator">&gt;</span><span class="token plain"> src/main.rs:3:5</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token number">3</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">                 println</span><span class="token operator">!</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;{}&quot;</span><span class="token plain">, env</span><span class="token operator">!</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;RUSTC_VERSION&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">))</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token operator">|</span><span class="token plain">                 ^^^^^^^</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  error: could not compile </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">`</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">wasm-test</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">`</span><span class="token plain"> due to </span><span class="token number">3</span><span class="token plain"> previous errors</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  ------------------------------------------------------------</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="success-1">Success<a href="#success-1" class="hash-link" aria-label="Direct link to Success" title="Direct link to Success">​</a></h3><p>As the wasm build is done on the entire runtime, I decided to try my luck against a single pallet instead. Similar to before, I tried the fee crate. This worked and to my surprise, MIRAI did not print any warnings or errors.</p><p>Next, I tried the bitcoin create that implements parsing and other somewhat error prone code. MIRAI gave me results here:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">warning: possible attempt to subtract with overflow</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   --</span><span class="token operator">&gt;</span><span class="token plain"> crates/bitcoin/src/parser.rs:239:24</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token number">239</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">     </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">let</span><span class="token plain"> target: U256 </span><span class="token operator">=</span><span class="token plain"> parser.parse</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain">?</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token operator">|</span><span class="token plain">                        ^^^^^^^^^^^^^^</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">note: related location</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   --</span><span class="token operator">&gt;</span><span class="token plain"> crates/bitcoin/src/parser.rs:177:40</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token number">177</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">         </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">let</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">result, bytes_consumed</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> T::parse</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token operator">&amp;</span><span class="token plain">self.raw_bytes, self.position</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain">?</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token operator">|</span><span class="token plain">                                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">note: related location</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   --</span><span class="token operator">&gt;</span><span class="token plain"> crates/bitcoin/src/parser.rs:151:23</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token number">151</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">         </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">let</span><span class="token plain"> compact </span><span class="token operator">=</span><span class="token plain"> U256::set_compact</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">bits</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain">.ok_or</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">Error::InvalidCompact</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain">?</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token operator">|</span><span class="token plain">                       ^^^^^^^^^^^^^^^^^^^^^^^</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">note: related location</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   --</span><span class="token operator">&gt;</span><span class="token plain"> crates/bitcoin/src/math.rs:53:25</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token number">53</span><span class="token plain">  </span><span class="token operator">|</span><span class="token plain">             word </span><span class="token operator">&lt;&lt;</span><span class="token plain"> </span><span class="token number">8</span><span class="token plain"> * </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">size - </span><span class="token number">3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token operator">|</span><span class="token plain">                         ^^^^^^^^^^</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="summary">Summary<a href="#summary" class="hash-link" aria-label="Direct link to Summary" title="Direct link to Summary">​</a></h2><p>Overall, I was very happy with the results. I was able to run two tools against the crates without additional configuration and they found potential issues. Next up will be trying to implement custom verification rules and dive deeper into the identified issues.</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/blockchain">blockchain</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/security">security</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/software-engineering">software-engineering</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/rust">rust</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/lean-execution">Lean Execution: How to Stay Focused</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2022-02-21T00:00:00.000Z" itemprop="datePublished">February 21, 2022</time> · <!-- -->4 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://harz.dev" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/nud3l.png" alt="Dominik Harz"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://harz.dev" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Dominik Harz</span></a></div><small class="avatar__subtitle" itemprop="description">CTO Interlay</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>When building a company and shipping a product, it&#x27;s both critical and extremely hard to stay focused.
Much has been written about this subject before.
I&#x27;m sharing here which three questions I&#x27;m trying to ask myself to help to stay lean.</p><h1>Why do we need this feature?</h1><p>Most of the time, you or a colleague got a great idea to improve the product or the company.
Especially, when you have not found product-market fit yet or the company is growing, you might feel the urge to add things, change things, and generally make sure you are set up for success.
However, I find myself often in discussions bout how to implement said change/feature instead of why?
Before going into the actual implementation, I try to understand two critical aspects:</p><ul><li>What benefit does this change bring to our users? This can be the users of our product, users of internal or external processes, or anyone that stands to benefit from this change. It&#x27;s helpful to classify the using T-shirt sizes from S to XL and later go into a more concrete assessment (what % of our user base profits from this, are these the critical users, ...).</li><li>Does this support our company goals in the mid/long-term? Sometimes a new feature can be beneficial to a user, but might not be in the long-term strategical interest of the company. I like to also use the T-shirt sizes here to gauge this question and later analyze this in more detail.</li></ul><h1>When do we need this feature?</h1><p>Before talking about how to implement a feature, it&#x27;s critical to understand where it fits in the roadmap.
If you anyway decided that the feature does not add any benefit (see question 1), it&#x27;s likely not worthwhile to specify a concrete timeline but rather give it some sort of medium or low priority on the backlog.
However, if it&#x27;s an important feature, the next step is to understand the dependencies of where it fits in the roadmap.</p><p>Some key questions I like to think about:</p><ul><li>Does the feature require another feature to be launched first to make it useful? Understand if there is a required sequence of steps.</li><li>Can we launch without the feature? Is the feature critical and we cannot ship to the user without it. Or would it be great to have at launch but not critical.</li></ul><h1>How should we launch the feature?</h1><p>After understanding the added value of the feature and its order in the timeline, the next step is to understand how the feature should be launched.
Sometimes this process is overlooked but I find it helpful to acknowlegdge that you can and often should simplify features to their core value proposition.
In crypto, the first iteration of Uniswap was simple but it worked.
MakerDAO launched with a single collateral asset and it worked as well.
Identifying the critical feature set is a hard exercise and requires an excellent understanding of user demand and competitor position.</p><p>I&#x27;m an engineer and researcher at heart and we tend to often strive for a perfect, over-engineered solution that covers every edge case.
It&#x27;s even worse coming from a security-focused background where your first step is to ask: How do we break this protocol?</p><p>In the product world, I found it often acceptable to tolerate limited sub-optimal edge cases in the product, acknowledge them, and fix them later.
The point here is that you want to get a product out at the right time.
And more often than not, getting the feature out with its essential benefit and have it &quot;good enough&quot; saves significant effort.</p><p>This last point I find often overlooked. Additional complexity in the feature costs us often 3x more time investment down the line since it&#x27;s not just the design that is more complicated. It&#x27;s also the implementation, the documentation, and the testing that are proportionally more involved.</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/agile">agile</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/lean">lean</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/execution">execution</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/startup">startup</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/product">product</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/engineering">engineering</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/maker-collateral-attack">Stealing All of Maker&#x27;s Collateral</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2020-02-20T00:00:00.000Z" itemprop="datePublished">February 20, 2020</time> · <!-- -->9 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://harz.dev" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/nud3l.png" alt="Dominik Harz"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://harz.dev" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Dominik Harz</span></a></div><small class="avatar__subtitle" itemprop="description">CTO Interlay</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>Or why Oracle Vulnerabilities are not the Worst Application of Flash Loans.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="tldr">tl;dr<a href="#tldr" class="hash-link" aria-label="Direct link to tl;dr" title="Direct link to tl;dr">​</a></h2><ul><li>You can potentially steal all of Maker’s collateral ($700m) and issue arbitrary amounts of new Dai using flash loans if no delay for new governance contracts is introduced.</li><li>Anyone can execute the attack and only needs to pay the transaction fees (few $) without holding any MKR.</li><li>If Maker does not introduce a delay until the liquidity pools for flash loan pools gets above a threshold, there is little chance to prevent the attack (race condition).</li><li>We have reached out to Maker February 8, 2020 about our research and had a call with them on February 14, 2020 to discuss our findings. Maker is aware of the attack vector <a href="https://forum.makerdao.com/t/all-mkr-holders-on-friday-12pm-pst-please-vote-for-the-gsm-to-be-activated/1303" target="_blank" rel="noopener noreferrer">and is holding a vote this Friday 12pm PST that would prevent the attack</a>.</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="introduction">Introduction<a href="#introduction" class="hash-link" aria-label="Direct link to Introduction" title="Direct link to Introduction">​</a></h2><p>Maker and its Dai stablecoin is the most popular so-called decentralized finance (DeFi) project on Ethereum with around of $700m locked in its smart contracts. The Maker protocol relies on a governance process encoded in a smart contract. MKR token holders can vote to replace an existing governance contract. Votes are proportional to the amount of MKR. The total number of MKR tokens is around 987,530 <a href="https://etherscan.io/token/0x9f8f72aa9304c8b593d555f12ef6589cc3a579a2#balances" target="_blank" rel="noopener noreferrer">where selected wallets or contracts hold large quantities of the token</a>:</p><ul><li>[Maker Governance Contract: 192,910 MKR]</li><li>Maker Foundation: 117,993 MKR</li><li>a16z: 60,000 MKR</li><li>0xfc7e22c6afa3ebb723bdde26d6ab3783aab9726b: 51,291 MKR</li><li>0x000be27f560fef0253cac4da8411611184356549: 39,645 MKR</li></ul><p>Note: the Maker Governance Contract contains MKR tokens of multiple parties.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="governance-attack">Governance Attack<a href="#governance-attack" class="hash-link" aria-label="Direct link to Governance Attack" title="Direct link to Governance Attack">​</a></h2><p>In a <a href="https://medium.com/coinmonks/how-to-turn-20m-into-340m-in-15-seconds-48d161a42311" target="_blank" rel="noopener noreferrer">post from December 2019, Micah Zoltu</a> pointed out how to attack the Maker governance contract. The basic idea is to accumulate enough MKR tokens to replace the existing governance contract with the attackers, malicious, governance contract. The malicious governance contract is then able to give the attacker full control over the system and withdraw any collateral in the system as well as create arbitrary amounts of new Dai.</p><p>To reduce the number of required MKR tokens, he proposed to execute the attack when new governance contracts are being voted on. At the moment, 192,910 MKR tokens are locked in the governance contract. However, an attacker would need less tokens if, say two or three contracts, would be voted on in parallel with similar token distributions. This frequently happened in the past as we can observe in the graph below:</p><p><img loading="lazy" src="/assets/images/mkr_locked-79e0b1ef4dcbf0f4e43816d4364c5e75.webp" width="640" height="480" class="img_ev3q"></p><p>The obvious attack strategy would be to crowd-fund the required MKR tokens through a smart contract and pay each attacker a share of the of the winnings. However, the attackers need to amass probably around 50k MKR tokens to have a chance to attack the system without Maker noticing these movements. We do show a strategy for this in our <a href="https://arxiv.org/abs/2002.08099" target="_blank" rel="noopener noreferrer">latest paper</a>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="a-brave-new-attack-strategy-flash-loans">A Brave New Attack Strategy: Flash Loans<a href="#a-brave-new-attack-strategy-flash-loans" class="hash-link" aria-label="Direct link to A Brave New Attack Strategy: Flash Loans" title="Direct link to A Brave New Attack Strategy: Flash Loans">​</a></h2><p>However, we can completely lift the requirement to amass MKR tokens if we consider using flash loans instead. Flash loans are a fairly new concept and therefore we give a brief explanation here. Normally, an agent has to provide collateral to take out a loan in the DeFi space. For example, in Maker, Alice can borrow Dai by depositing ETH. This is required since we operate under a model of <a href="https://bdlt.school/files/slides/talk-rainer-b%C3%B6hme-a-primer-on-economics-for-cryptocurrencies.pdf" target="_blank" rel="noopener noreferrer">weak identities</a> and <a href="https://eprint.iacr.org/2019/675" target="_blank" rel="noopener noreferrer">economically rational agents</a>.</p><p>A flash loan lifts this requirement as it only takes place in a single transaction:</p><ol><li>Alice takes out the loan from a flash loan liquidity provider (e.g. Aave or dYdX)</li><li>Alice executes some actions (e.g. arbitrage trading on Uniswap, Fulcrum, Kyber etc.)</li><li>Alice pays back the flash loan with interest</li></ol><p>A flash loan works in three steps within a single transaction.</p><p><img loading="lazy" src="/assets/images/flash-loan-ad22ea3dffc0db7e13540ee02ccca7ac.webp" width="966" height="389" class="img_ev3q"></p><p>The flash loan works because of how the Ethereum Virtual Machine is designed: if at any point during this transaction the flash loan fails, the whole transaction is reverted. Hence, Alice can take the loan risk free, i.e. if she cannot pay it back it would be like she would have never taken it. The liquidity providers are also winning: they have only lent their funds if Alice was able to pay them back.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="arbitrage-and-oracle-manipulation-with-flash-loans">Arbitrage and Oracle Manipulation with Flash Loans<a href="#arbitrage-and-oracle-manipulation-with-flash-loans" class="hash-link" aria-label="Direct link to Arbitrage and Oracle Manipulation with Flash Loans" title="Direct link to Arbitrage and Oracle Manipulation with Flash Loans">​</a></h2><p>On February 14 and February 18, two incidents involving flash loans occurred that caused <a href="https://bzx.network/" target="_blank" rel="noopener noreferrer">bZx</a> to halt its platform. In the <a href="https://etherscan.io/tx/0xb5c8bd9430b6cc87a0e2fe110ece6bf527fa4f170a4bc8cd032f768fc5219838" target="_blank" rel="noopener noreferrer">first transaction</a>, a single flash loan was able to make a profit of 1,193 ETH (approx. $298,250). This transaction was executed using a smart contract that opened a short position on Fulcrum on wBTC. In the same transaction, the transaction took out a wBTC loan on Compound and executed a trade of wBTC on Kyber’s Uniswap reserve resulting in slippage ultimately bringing down the price on Fulcrum as well. The full details can be found in the <a href="https://bzx.network/blog/postmortem-ethdenver" target="_blank" rel="noopener noreferrer">post-mortem by bZx</a> and a <a href="https://medium.com/@peckshield/bzx-hack-full-disclosure-with-detailed-profit-analysis-e6b1fa9b18fc" target="_blank" rel="noopener noreferrer">detailed analysis of the involved calls by PeckShield</a>.</p><p>Similarly, a second incident occurred on February 18 where in a <a href="https://etherscan.io/tx/0x762881b07feb63c436dee38edd4ff1f7a74c33091e534af56c9f7d49b5ecac15" target="_blank" rel="noopener noreferrer">single transaction</a> a profit of 2,378 ETH (approx. $600,000) was made. This transaction involved an initial borrowing of 7,500 ETH to take a long position on <a href="https://www.synthetix.io/tokens/" target="_blank" rel="noopener noreferrer">Synthetix&#x27;</a> sUSD. More details are found in this <a href="https://twitter.com/DegenSpartan/status/1229646531717820416?s=20" target="_blank" rel="noopener noreferrer">informal analysis</a>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="oracle-manipulation-to-reduce-required-liquidity">Oracle Manipulation to Reduce Required Liquidity<a href="#oracle-manipulation-to-reduce-required-liquidity" class="hash-link" aria-label="Direct link to Oracle Manipulation to Reduce Required Liquidity" title="Direct link to Oracle Manipulation to Reduce Required Liquidity">​</a></h2><p>For our attack, we assume that 50k MKR are sufficient. Even if in practice the number of tokens could be higher, we point out how the concept of flash loans makes securing Maker, without a governance delay, hard. In a naive approach, the attacker could take out a flash loan to buy 50k MKR tokens.</p><p>At current exchange rates, the attacker <a href="https://dexindex.io/?symbol=MKR&amp;amount=50000&amp;action=buy" target="_blank" rel="noopener noreferrer">needs around 485,000 ETH to buy that amount of MKR as only a single exchange</a>, Kyber, has enough volume available. However, the attacker can also leverage multiple exchanges and buy 38k MKR from Kyber, 11.5k from Uniswap, and 500 MKR from Switcheo for a total of 378,940 ETH. That number is still high but already a reduction by almost 100,000 ETH!</p><p>An attacker can use the oracle manipulation strategies above to effectively bring down the price of MKR on Kyber and Uniswap. These are the two largest providers of MKR and have shown to be vulnerable to oracle price manipulation. Further analysis is required to determine how much the MKR price can be reduced. However, on a less liquid token like wBTC an <a href="https://medium.com/@peckshield/bzx-hack-full-disclosure-with-detailed-profit-analysis-e6b1fa9b18fc" target="_blank" rel="noopener noreferrer">attacker was able manipulate the exchange rate by around 285%</a>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="obtaining-enough-liquidity">Obtaining enough Liquidity<a href="#obtaining-enough-liquidity" class="hash-link" aria-label="Direct link to Obtaining enough Liquidity" title="Direct link to Obtaining enough Liquidity">​</a></h2><p><img loading="lazy" alt="eth-locked.webp" src="/assets/images/eth-locked-49ebf20958f73b922d3811a3aceafa28.webp" width="786" height="412" class="img_ev3q"></p><p>Even with oracle manipulation, a large number of ETH is required to execute the attack on Maker. However, an attacker can increase its liquidity by taking out two flash loans within the same transaction. Aave and dYdX protect themselves against reentrancy and allow only a single flash loan within a single transaction. But the attacker can borrow ETH from both protocols within the same transaction.</p><p><img loading="lazy" src="/assets/images/eth-locked-dydx-71e47f9a802fa4f73b434ccd6f490d88.webp" width="783" height="413" class="img_ev3q"></p><p>Thus, as of February 18, the attacker has a pool of around <a href="https://trade.dydx.exchange/markets" target="_blank" rel="noopener noreferrer">90k ETH on dYdX</a> plus <a href="https://app.aave.com/borrow/ETH" target="_blank" rel="noopener noreferrer">17k ETH on Aave</a> available. Hence, at current liquidity rates an attacker could take out a combined ~107k ETH loan from both dYdX and Aave to try to manipulate the MKR token price and obtain enough MKR tokens to replace the current Maker governance contract with its own.</p><p>For this to succeed the attacker must be able to reduce average MKR price by at least 3.54 times. Alternatively, the attacker can also wait for dYdX and Aave to increase its liquidity pools. With the current growth rate of around 5% of both protocols, it does not seem unlikely that the attack becomes possible within two months.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="combination">Combination?<a href="#combination" class="hash-link" aria-label="Direct link to Combination?" title="Direct link to Combination?">​</a></h2><p>Obviously, it is possible to combine the crowd funding approach and the flash loan together. Using the available liquidity of ~107k ETH, it is possible to obtain around 10,800 MKR from Kyber. This would allow multiple attackers to reduce the required amount of pooling together 50k MKR to just around 39.2k MKR. It seems also that some people are indeed interested in such an attack as this informal Twitter poll shows:</p><p><img loading="lazy" src="/assets/images/twitter-ca74db5863009f30e89defb4e12a4a17.webp" width="786" height="376" class="img_ev3q"></p><p><a href="https://etherscan.io/token/0x9f8f72aa9304c8b593d555f12ef6589cc3a579a2#balances" target="_blank" rel="noopener noreferrer">It can also be noted that the top four account holders</a> (in fact five, but not considering the current Maker Governance Contract) are able to execute the attack without crowdfunding.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="no-time-to-wait">No Time to Wait<a href="#no-time-to-wait" class="hash-link" aria-label="Direct link to No Time to Wait" title="Direct link to No Time to Wait">​</a></h2><p>Once enough liquidity is available through the flash loan lending pools (with or without the combination of using oracle manipulation), anyone is able to take over the Maker governance contract. Once Maker starts a vote when the liquidity pools have reached that threshold, Maker needs to ensure that MKR tokens are as little distributed as possible. If the distribution of MKR at any point in this voting procedure allows for an exploit of the vulnerability, any collateral can be taken away.</p><p>That attacker would be able to steal $700m worth of ETH collateral and be able to print new Dai at will. This attack would spread throughout the whole DeFi space as Dai is used as backing collateral in other protocols. Further, the attacker can use his Dai to trade other currencies worth around $230m. <a href="https://arxiv.org/abs/2002.08099" target="_blank" rel="noopener noreferrer">We give a more detailed analysis in our paper.</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="counter-measure">Counter measure<a href="#counter-measure" class="hash-link" aria-label="Direct link to Counter measure" title="Direct link to Counter measure">​</a></h2><p>Maker should put a new governance contract in place that prevents flash loans from attacking their system. Specifically, a new governance contract should be able to be checked by the Maker Foundation for malicious code and give enough time to react. At the bare minimum, a new governance contract should not be able to go live within a single transaction. That way, the attacker can likely not profit from the attack and thus not repay the flash loan.
If the attacker cannot repay the flash loan, the attack is like it would have never happened.</p><p>Maker is putting such a contract to vote on Friday, 12pm PST, February 21, 2020. <a href="https://forum.makerdao.com/t/all-mkr-holders-on-friday-12pm-pst-please-vote-for-the-gsm-to-be-activated/1303/2" target="_blank" rel="noopener noreferrer">The proposed contract would activate the Governance Security Module (GSM) and prevent such a flash loan attack.</a></p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/de-fi">DeFi</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/maker-dao">MakerDAO</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/security">Security</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/flashloans">Flashloans</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/analysing-ethereum-gas-cost">Analysing Ethereum contract gas costs during development</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2018-11-06T00:00:00.000Z" itemprop="datePublished">November 6, 2018</time> · <!-- -->5 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://harz.dev" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/nud3l.png" alt="Dominik Harz"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://harz.dev" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Dominik Harz</span></a></div><small class="avatar__subtitle" itemprop="description">CTO Interlay</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>Updating the state of a smart contract in Ethereum costs money. In this post I will go a bit into detail why this is necessary in Ethereum and how to check easily (with <code>truffle test</code>) your gas costs during local development. For this we will use a little pet example, you can use for your own deployments.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="gas-cost---why">Gas cost - why?<a href="#gas-cost---why" class="hash-link" aria-label="Direct link to Gas cost - why?" title="Direct link to Gas cost - why?">​</a></h2><p>Ethereum smart contracts are deployed at an address in the Ethereum network. They are identifiable by the fact that the <code>code</code> field in the address is occupied by the EVM bytecode. One example is the Maker <a href="https://etherscan.io/address/0x89d24a6b4ccb1b6faa2625fe562bdd9a23260359#code" target="_blank" rel="noopener noreferrer">Dai contract</a>. Any contract in Ethereum is deployed that way and implements a range of functions that can update its own state and the state of the blockchain.</p><p>The own state is defined within the contract and refers to any contract wide variables you define like <code>uint</code>, <code>mapping</code>, or <code>string</code>. The global state of the network is affected when you make a transaction to a contract, which, if everything goes right, will include one more transaction in the ever-growing list of transactions.</p><p>Everytime somebody invokes a state update (i.e. sends a transaction), the network reaches consensus over this operation. If 50% + 1 decide that the state transition is valid, the network state gets updated. However, this means that if you have a function that does <code>5 + 4</code> and stores the result to a contract variable, every node in the network need to verify that the result is in fact <code>9</code>. Assuming that Ethereum has <a href="https://www.ethernodes.org/network/1" target="_blank" rel="noopener noreferrer">more than 12,000 nodes</a>, this is quite costly.</p><p>Moreover, assume that any of these operations are free. One could simply create a function that runs indefinitely to block all nodes verifying the network. This is the equivalent to a distributed denial-of-service attack. It would be nice if we would know in advance if a function terminates. However, the <a href="https://en.wikipedia.org/wiki/Halting_problem" target="_blank" rel="noopener noreferrer">Halting problem</a> prevents us from knowing this. Hence, we have to charge partial function execution and forcefully terminate execution when it becomes to burdensome for the network.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="practical-implications">Practical implications<a href="#practical-implications" class="hash-link" aria-label="Direct link to Practical implications" title="Direct link to Practical implications">​</a></h2><p>Operations executed by the EVM cost gas depending how &quot;heavy&quot; they are on the network. Gas is a way of determining the cost for an operation. The current gas price on the other hand determines how much 1 gas costs in Ether. That way, the gas cost can be adjusted depending on the network load. For example, while the gas cost for a single operation is constant, the gas price can go up when the network is congested. An overview <a href="https://ethereum.github.io/yellowpaper/paper.pdf" target="_blank" rel="noopener noreferrer">of the gas costs are found in appendix G of the yellow paper</a>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="local-execution-and-global-execution">Local execution and global execution<a href="#local-execution-and-global-execution" class="hash-link" aria-label="Direct link to Local execution and global execution" title="Direct link to Local execution and global execution">​</a></h2><p>Any operation on a smart contract costs gas. It is important to note a difference though. <strong>Calls</strong> are only executed locally. So for example the function below measures its gas, but the you will not be charged executing such a function as it is a read-only function.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">function balanceOf(address owner) public view returns (uint256) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    return _balances[owner];</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>However, <strong>transactions</strong> will deduct Ether from your balance as those are executed by the global network and miners need to have an incentive to include your transaction in a block. So the function below is from an ERC20 and executes a transfer. This updates the contract state, and thus requires a transaction.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">function _transfer(address from, address to, uint256 value) internal {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    require(value &lt;= _balances[from]);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    require(to != address(0));</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    _balances[from] = _balances[from].sub(value);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    _balances[to] = _balances[to].add(value);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    emit Transfer(from, to, value);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="measuring-gas-costs">Measuring gas costs<a href="#measuring-gas-costs" class="hash-link" aria-label="Direct link to Measuring gas costs" title="Direct link to Measuring gas costs">​</a></h2><p>I will assume here that you are familiar with <a href="https://truffleframework.com/docs" target="_blank" rel="noopener noreferrer">Truffle</a> and <a href="https://truffleframework.com/docs/ganache/overview" target="_blank" rel="noopener noreferrer">Ganache</a>. When you develop your new great smart contracts, I like to create end-to-end tests that also check for gas costs.</p><p>Assuming your project folder looks something like this:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">contracts/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">migrations/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">test/</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>I am creating a folder <code>mkdir experiments</code> where I will store the number of transactions each of my interactions require and the amount of gas that this operation is using.</p><p>Next, I&#x27;m creating a test script <code>demo.js</code> in the test folder. I like to store my experiments in a CSV format so I can import it to other tools. First, the required imports:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">var fs = require(&quot;fs&quot;);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">var csvWriter = require(&#x27;csv-write-stream&#x27;);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">var writer = csvWriter();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">// your contract</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">const ERC20 = artifacts.require(&quot;./ERC20.sol&quot;);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>You will write your tests based on the Truffle/Mocha/Chai interface. For this, I&#x27;m creating the variables I am using to store the measurements.
Also, I am using the <code>before</code> construct to setup the CSV writer. During tests I would update the gas and number of transaction related counters.</p><p>After the tests are finished, the data is written to a CSV file. To USD conversion uses a helper function.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">contract(&#x27;ERC20&#x27;, async (accounts) =&gt; {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // gas price conversion</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    const gas_limit = 7988288;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // experiment related vars</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    var transfer_success_gas = 0;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    var transfer_fail_gas = 0;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    var transfer_success_tx = 0;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    var transfer_fail_tx = 0;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // any other const or vars</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // ...</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    before(&#x27;Create writer for experiments&#x27;, async () =&gt; {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        writer.pipe(fs.createWriteStream((&#x27;./experiments/ERC20.csv&#x27;)));</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    })</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    after(&#x27;Write experiment data to file&#x27;, async () =&gt; {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        let transfer_success_usd = convertToUsd(transfer_success_gas);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        let transfer_fail_usd = convertToUsd(transfer_fail_gas);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        writer.write(</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    Transfer: transfer_success_gas,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    TransferFail: transfer_fail_gas,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                });</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        writer.write(</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                Transfer: transfer_success_usd,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                TransferFail: transfer_fail_usd,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            });</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        writer.write(</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                Transfer: transfer_success_tx,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                TransferFail: transfer_fail_tx,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            });</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        writer.end();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    })</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // your tests</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // it(&quot;Transfer Success&quot;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // it(&quot;Transfer Fail&quot;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">})</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The USD conversion function works like this. I have this in a separate file called <code>helpers.js</code> that I export/import as a module.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">convertToUsd: function (gasCost) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // gas price conversion</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    const gas_price = web3.toWei(5, &quot;gwei&quot;);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    const eth_usd = 200; // USD</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    return gasCost * web3.fromWei(gas_price, &quot;ether&quot;) * eth_usd;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>That&#x27;s it. You can run the experiment with <code>truffle test path/to/the/file.js</code>.</p></div><footer class="row docusaurus-mt-lg"></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/bitcoin-smart-contracts-mechanism-design">Analyzing Bitcoin smart contracts from a mechanism design perspective</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2018-09-12T00:00:00.000Z" itemprop="datePublished">September 12, 2018</time> · <!-- -->11 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://harz.dev" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/nud3l.png" alt="Dominik Harz"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://harz.dev" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Dominik Harz</span></a></div><small class="avatar__subtitle" itemprop="description">CTO Interlay</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>Contracts can be used to enforce agreements between entities.
To this extent, smart contracts have been proposed by Nick Szabo and implemented for example in Bitcoin.
This article covers the basics of mechanism design of smart contracts in the context of Bitcoin.
Mechanism design is concerned with creating or encoding preferences in an agreement.
Hence, an author of a smart contract can create a mechanism that enforces certain behaviour of the agents (or humans) interacting with the contract.
Essentially, the author of the contract wants to reward desired behaviours and punish undesired behaviours.
This is widely used in cryptocurrency protocols including the Lightning Network or Ethereum-based protocols such as Casper or TrueBit.</p><p><strong>Use Case:</strong> Agents having access to sensors could sell the sensor data they are collecting to agents willing to buy this data.
This represents a simple contract where a resource is exchanged for a price.
Bitcoin in combination with payment channels secure the payments and allow for micro-payments.
Thus, one has to design protocols integrating with these existing technologies to achieve for example secure decentralised data exchanges.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="bitcoin-and-smart-contracts">Bitcoin and smart contracts<a href="#bitcoin-and-smart-contracts" class="hash-link" aria-label="Direct link to Bitcoin and smart contracts" title="Direct link to Bitcoin and smart contracts">​</a></h2><p>Nakamoto introduced Bitcoin as a way to send money between peers without trusted third parties <!-- -->[<!-- -->2<!-- -->]<!-- -->.
In Nakamoto consensus the heaviest chain is considered having correct transactions as most miners have contributed to this specific chain by solving a proof of work (PoW) puzzle.
Assuming that the majority of players in the system are honest (i.e. <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>50</mn><mi mathvariant="normal">%</mi><mo>+</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">50\% + 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.0833em"></span><span class="mord">50%</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:0.6444em"></span><span class="mord">1</span></span></span></span></span>), the heaviest chain represents the &quot;true&quot; state of the network.</p><p>Bitcoin also included the capability of executing smart contracts with Bitcoin Script <!-- -->[<!-- -->3<!-- -->]<!-- -->.
A smart contract is a piece of software which formalises a relationship between entities much like a legal contract <!-- -->[<!-- -->4<!-- -->]<!-- -->.
However, the idea is to use secure computer protocols and include game theoretic elements to cover aspects that cannot be adequately verified in the protocol.
Szabo argues that smart contracts cover interactions including search, negotiation, commitment, performance, and adjudication.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="rational-agents">Rational agents<a href="#rational-agents" class="hash-link" aria-label="Direct link to Rational agents" title="Direct link to Rational agents">​</a></h2><p>Agents in decentralised systems are self-interested <!-- -->[<!-- -->5<!-- -->]<!-- -->.
Hence, protocols facilitating (economic) interactions between agents need to account for autonomous agents to behave rationally.
A set of agents <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mo>=</mo><mo stretchy="false">{</mo><mn>1...</mn><mi>n</mi><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">P = \{1 ... n\}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em"></span><span class="mord mathnormal" style="margin-right:0.13889em">P</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mopen">{</span><span class="mord">1...</span><span class="mord mathnormal">n</span><span class="mclose">}</span></span></span></span></span> is considered to be rational if they seek maximise their utility <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>u</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">u_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em"></span><span class="mord"><span class="mord mathnormal">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span></span></span> depending on some function <!-- -->[<!-- -->5<!-- -->]<!-- --> <!-- -->[<!-- -->6<!-- -->]<!-- --> <!-- -->[<!-- -->1<!-- -->]<!-- -->.
This is especially relevant in decentralised systems, where we have to assume agents act only in their interest.
Agents can apply multiple strategies <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mo>∈</mo><mi>S</mi></mrow><annotation encoding="application/x-tex">s \in S</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em"></span><span class="mord mathnormal">s</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:0.6833em"></span><span class="mord mathnormal" style="margin-right:0.05764em">S</span></span></span></span></span> within a negotiation <!-- -->[<!-- -->1<!-- -->]<!-- -->.
We have to assume that agents will execute actions <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>θ</mi><mo>∈</mo><mi mathvariant="normal">Θ</mi></mrow><annotation encoding="application/x-tex">\theta \in \Theta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7335em;vertical-align:-0.0391em"></span><span class="mord mathnormal" style="margin-right:0.02778em">θ</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:0.6833em"></span><span class="mord">Θ</span></span></span></span></span> based on <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi></mrow><annotation encoding="application/x-tex">s</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em"></span><span class="mord mathnormal">s</span></span></span></span></span> that optimises their utility including cheating, lying, breaking contracts, and hiding their intentions.
However, we also assume that agents that interact can find an outcome <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ω</mi><mo>∈</mo><mi mathvariant="normal">Ω</mi></mrow><annotation encoding="application/x-tex">\omega \in \Omega</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em"></span><span class="mord mathnormal" style="margin-right:0.03588em">ω</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:0.6833em"></span><span class="mord">Ω</span></span></span></span></span> that increases or optimises <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>u</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">u_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em"></span><span class="mord"><span class="mord mathnormal">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span></span></span>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="mechanism-design">Mechanism design<a href="#mechanism-design" class="hash-link" aria-label="Direct link to Mechanism design" title="Direct link to Mechanism design">​</a></h2><p>Mechanism design is used to encode preferences in an agreement.
Essentially, a &quot;designer&quot; defines a preferred social choice which, under the assumption of rational agents, the mechanism is intended to favour <!-- -->[<!-- -->6<!-- -->]<!-- -->.
Considering a contract <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi></mrow><annotation encoding="application/x-tex">C</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em"></span><span class="mord mathnormal" style="margin-right:0.07153em">C</span></span></span></span></span> as an agreement between agents, <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi></mrow><annotation encoding="application/x-tex">C</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em"></span><span class="mord mathnormal" style="margin-right:0.07153em">C</span></span></span></span></span> implements a mechanism <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>M</mi><mo>=</mo><mo stretchy="false">(</mo><mi mathvariant="normal">Σ</mi><mo separator="true">,</mo><mi>g</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">M = (\Sigma, g)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em"></span><span class="mord mathnormal" style="margin-right:0.10903em">M</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mopen">(</span><span class="mord">Σ</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em"></span><span class="mord mathnormal" style="margin-right:0.03588em">g</span><span class="mclose">)</span></span></span></span></span> <!-- -->[<!-- -->7<!-- -->]<!-- -->.
The outcome of the mechanism <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>g</mi></mrow><annotation encoding="application/x-tex">g</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em"></span><span class="mord mathnormal" style="margin-right:0.03588em">g</span></span></span></span></span> depends on the actions of agents <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">Σ</mi></mrow><annotation encoding="application/x-tex">\Sigma</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em"></span><span class="mord">Σ</span></span></span></span></span>.
<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>M</mi></mrow><annotation encoding="application/x-tex">M</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em"></span><span class="mord mathnormal" style="margin-right:0.10903em">M</span></span></span></span></span> implements a rule <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi></mrow><annotation encoding="application/x-tex">f</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em"></span><span class="mord mathnormal" style="margin-right:0.10764em">f</span></span></span></span></span>.
Rational agents would only enter <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi></mrow><annotation encoding="application/x-tex">C</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em"></span><span class="mord mathnormal" style="margin-right:0.07153em">C</span></span></span></span></span> or follow <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi></mrow><annotation encoding="application/x-tex">C</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em"></span><span class="mord mathnormal" style="margin-right:0.07153em">C</span></span></span></span></span> if <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi></mrow><annotation encoding="application/x-tex">f</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em"></span><span class="mord mathnormal" style="margin-right:0.10764em">f</span></span></span></span></span> is the result of the dominant strategies or Nash equilibrium of the agents.</p><p>An agent will have multiple options to enter contracts with other agents.
To ensure that the proposed contract <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi></mrow><annotation encoding="application/x-tex">C</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em"></span><span class="mord mathnormal" style="margin-right:0.07153em">C</span></span></span></span></span> is chosen, we want to have it incentive compatible.
Loosely speaking incentive compatibility of a mechanism occurs when the utility <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>u</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">u_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em"></span><span class="mord"><span class="mord mathnormal">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span></span></span> of each agent <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6595em"></span><span class="mord mathnormal">i</span></span></span></span></span> is maximised when an agent is &quot;truth-telling&quot; (i.e. the dominant strategy).
In games without money, non-trivial choices (e.g. more than two contracts, multiple potential agents, multiple different terms) lead either to incentive incompatibility, or the social choice function is a dictatorship according to the Gibbard--Satterthwaite theorem.
However, in Bitcoin, we can construct games with money.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="games-in-bitcoin">Games in Bitcoin<a href="#games-in-bitcoin" class="hash-link" aria-label="Direct link to Games in Bitcoin" title="Direct link to Games in Bitcoin">​</a></h2><p>In games with money, a Vickery-Clarke-Groves (VCG) mechanism maximises social welfare.
A VCG mechanism is incentive compatible. Hence an agent strives to implement a contract as such a mechanism.
To construct such games the mechanism the Clarke pivot rule can be applied <!-- -->[<!-- -->6<!-- -->]<!-- -->.
Agents in Bitcoin are playing a game with strict incomplete information.
One could argue that an agent could potentially analyse actions of an agent as transactions are public.
However, as agents might take multiple identities (Sybil), this is a non-trivial task, and thus, we will not consider it in this case.
We further assume that agents have independent private values, i.e. resources subject to trade do not depend on the other agents.</p><p>Such a game can be defined as follows <!-- -->[<!-- -->6<!-- -->]<!-- -->:</p><ul><li>A set of players <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mo>=</mo><mo stretchy="false">{</mo><mn>1</mn><mo separator="true">,</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mo separator="true">,</mo><mi>n</mi><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">P = \{1, .., n\}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em"></span><span class="mord mathnormal" style="margin-right:0.13889em">P</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mopen">{</span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em"></span><span class="mord">..</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em"></span><span class="mord mathnormal">n</span><span class="mclose">}</span></span></span></span></span> exists.</li><li>Every player <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6595em"></span><span class="mord mathnormal">i</span></span></span></span></span> has a set of actions <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi mathvariant="normal">Σ</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">\Sigma_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em"></span><span class="mord"><span class="mord">Σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span></span></span>.</li><li>Every player <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6595em"></span><span class="mord mathnormal">i</span></span></span></span></span> has a set of types <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>T</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">T_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span></span></span>. A value <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>t</mi><mi>i</mi></msub><mo>∈</mo><msub><mi>T</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">t_i \in T_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7651em;vertical-align:-0.15em"></span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span></span></span> is a private input to the player.</li><li>Every player <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6595em"></span><span class="mord mathnormal">i</span></span></span></span></span> has a utility function <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>u</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">u_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em"></span><span class="mord"><span class="mord mathnormal">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span></span></span>. The utility function depends on its private input and the actions of all players <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>u</mi><mi>i</mi></msub><mo>=</mo><mo stretchy="false">(</mo><msub><mi>t</mi><mi>i</mi></msub><mo separator="true">,</mo><msub><mi>σ</mi><mn>1</mn></msub><mo separator="true">,</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mo separator="true">,</mo><msub><mi>σ</mi><mi>n</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">u_i = (t_i, \sigma_1, .., \sigma_n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em"></span><span class="mord"><span class="mord mathnormal">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em">σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em"></span><span class="mord">..</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em">σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span>.</li></ul><p>Hence, a player must choose an action only based on his private input but without knowing the private inputs of other agents.
A strategy <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi></mrow><annotation encoding="application/x-tex">s</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em"></span><span class="mord mathnormal">s</span></span></span></span></span> describes an agent&#x27;s decision to execute a specific action based on a private input.
The agent will choose <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi></mrow><annotation encoding="application/x-tex">s</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em"></span><span class="mord mathnormal">s</span></span></span></span></span> that is the best response to any <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>σ</mi></mrow><annotation encoding="application/x-tex">\sigma</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em"></span><span class="mord mathnormal" style="margin-right:0.03588em">σ</span></span></span></span></span> by other agents.</p><p>However, an agent needs to optimise a specific social choice.
In Bitcoin, we are not concerned with social welfare as a social choice as this is unknown to the agents and they are not naturally interested in the utility of others.
In the case that only two agents are involved and we have a simple contract concerning one resource, single-parameter domains can be applied <!-- -->[<!-- -->6<!-- -->]<!-- -->.
In such domains, the valuation <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>v</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">v_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span></span></span> of an agent depends only on one parameter, say obtaining the resource.
Moreover, the price an agent is willing to pay is already included in the incentive mechanism.</p><p>Yet, this would only hold for the case where two agents compete for obtaining a single resource.
In more complex cases, for example, adding the quality of the data, we need to apply a more complex social choice function.
In these cases, variations of VCG are the only incentive compatible mechanisms <!-- -->[<!-- -->6<!-- -->]<!-- -->.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="assumptions">Assumptions<a href="#assumptions" class="hash-link" aria-label="Direct link to Assumptions" title="Direct link to Assumptions">​</a></h2><p>Using the resource exchange formalisation described in <!-- -->[<!-- -->1<!-- -->]<!-- --> the following tuple defines the exchange setting:</p><p><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>P</mi><mo separator="true">,</mo><mi mathvariant="script">Z</mi><mo separator="true">,</mo><mo stretchy="false">(</mo><msub><mi>v</mi><mi>i</mi></msub><msub><mo stretchy="false">)</mo><mrow><mi>i</mi><mo>∈</mo><mi>P</mi></mrow></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(P,\mathcal{Z}, (v_{i})_{i \in P})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.13889em">P</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em"></span><span class="mord mathcal" style="margin-right:0.07944em">Z</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">∈</span><span class="mord mathnormal mtight" style="margin-right:0.13889em">P</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1774em"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span></p><p>We are assuming that two agents exist, i.e. two players <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mo>=</mo><mo stretchy="false">{</mo><mi>A</mi><mo separator="true">,</mo><mi>B</mi><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">P = \{A, B\}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em"></span><span class="mord mathnormal" style="margin-right:0.13889em">P</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mopen">{</span><span class="mord mathnormal">A</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em"></span><span class="mord mathnormal" style="margin-right:0.05017em">B</span><span class="mclose">}</span></span></span></span></span>.
Those agents are exchanging a purely digital resource for a specific price.
The agents negotiate over a single resource <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>z</mi><mo>∈</mo><mi mathvariant="script">Z</mi></mrow><annotation encoding="application/x-tex">z \in \mathcal{Z}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em"></span><span class="mord mathnormal" style="margin-right:0.04398em">z</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:0.6833em"></span><span class="mord mathcal" style="margin-right:0.07944em">Z</span></span></span></span></span>.
Moreover, they use a valuation function <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>v</mi><mi>i</mi></msub><mo>:</mo><msup><mn>2</mn><mi mathvariant="script">Z</mi></msup><mo>→</mo><mi mathvariant="double-struck">R</mi></mrow><annotation encoding="application/x-tex">v_i : 2^{\mathcal{Z}} \to \mathbb{R}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">:</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:0.8413em"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413em"><span style="top:-3.063em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathcal mtight" style="margin-right:0.07944em">Z</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">→</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:0.6889em"></span><span class="mord mathbb">R</span></span></span></span></span>.
Agent <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em"></span><span class="mord mathnormal">A</span></span></span></span></span> hence defines the value <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>v</mi><mi>A</mi></msub><mo stretchy="false">(</mo><mi>z</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">v_A(z)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">A</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.04398em">z</span><span class="mclose">)</span></span></span></span></span> individually as well as agent <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi></mrow><annotation encoding="application/x-tex">B</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em"></span><span class="mord mathnormal" style="margin-right:0.05017em">B</span></span></span></span></span> in <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>v</mi><mi>B</mi></msub><mo stretchy="false">(</mo><mi>z</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">v_B(z)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05017em">B</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.04398em">z</span><span class="mclose">)</span></span></span></span></span>.</p><p>This valuation expresses the price an agent is willing to exchange the resource for, whereby we assume that <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>v</mi><mi>A</mi></msub><mo>≤</mo><msub><mi>v</mi><mi>B</mi></msub></mrow><annotation encoding="application/x-tex">v_A \leq v_B</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.786em;vertical-align:-0.15em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">A</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05017em">B</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span></span></span> if <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em"></span><span class="mord mathnormal">A</span></span></span></span></span> is offering the resource and <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi></mrow><annotation encoding="application/x-tex">B</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em"></span><span class="mord mathnormal" style="margin-right:0.05017em">B</span></span></span></span></span>, is willing to pay for it. Otherwise, there would be no price for them agree on.
In this simple case, we assume that the agents follow the negotiation protocol truthfully and that their utility <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>U</mi></mrow><annotation encoding="application/x-tex">U</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em"></span><span class="mord mathnormal" style="margin-right:0.10903em">U</span></span></span></span></span> increases when making a deal and exchanging the resource.
We further assume that the agents have a way to enter such an agreement, i.e. one of them can prepare a contract that the other one can interpret and willing to commit to.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="contract">Contract<a href="#contract" class="hash-link" aria-label="Direct link to Contract" title="Direct link to Contract">​</a></h2><p>The contract <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi></mrow><annotation encoding="application/x-tex">C</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em"></span><span class="mord mathnormal" style="margin-right:0.07153em">C</span></span></span></span></span> is implemented as an Hashed Timelock Contract (HTLC) <!-- -->[<!-- -->8<!-- -->]<!-- --> with multiple transactions in the Lightning Network. Note that <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em"></span><span class="mord mathnormal">A</span></span></span></span></span> sells data <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>z</mi></mrow><annotation encoding="application/x-tex">z</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em"></span><span class="mord mathnormal" style="margin-right:0.04398em">z</span></span></span></span></span>, and <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi></mrow><annotation encoding="application/x-tex">B</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em"></span><span class="mord mathnormal" style="margin-right:0.05017em">B</span></span></span></span></span> buys it for the agreed price <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi></mrow><annotation encoding="application/x-tex">p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em"></span><span class="mord mathnormal">p</span></span></span></span></span> in Satoshi. To allow agents to exchange <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>z</mi></mrow><annotation encoding="application/x-tex">z</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em"></span><span class="mord mathnormal" style="margin-right:0.04398em">z</span></span></span></span></span> and atomic swap is used. This protocol has been described for cross-chain transactions but is equally useful within a single chain <!-- -->[<!-- -->9<!-- -->]<!-- -->.</p><ol><li><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em"></span><span class="mord mathnormal">A</span></span></span></span></span> stores <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>z</mi></mrow><annotation encoding="application/x-tex">z</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em"></span><span class="mord mathnormal" style="margin-right:0.04398em">z</span></span></span></span></span> on IPFS receiving <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>H</mi><mo stretchy="false">(</mo><mi>z</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">H(z)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord mathnormal" style="margin-right:0.08125em">H</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.04398em">z</span><span class="mclose">)</span></span></span></span></span>. <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em"></span><span class="mord mathnormal">A</span></span></span></span></span> uses this as the secret for the HTLC and sends this to <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi></mrow><annotation encoding="application/x-tex">B</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em"></span><span class="mord mathnormal" style="margin-right:0.05017em">B</span></span></span></span></span>. As <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em"></span><span class="mord mathnormal">A</span></span></span></span></span> takes the Merkle root of <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>z</mi></mrow><annotation encoding="application/x-tex">z</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em"></span><span class="mord mathnormal" style="margin-right:0.04398em">z</span></span></span></span></span>, the data can be of (almost) any size.</li><li><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi></mrow><annotation encoding="application/x-tex">B</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em"></span><span class="mord mathnormal" style="margin-right:0.05017em">B</span></span></span></span></span> prepares a transaction transferring <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi></mrow><annotation encoding="application/x-tex">p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em"></span><span class="mord mathnormal">p</span></span></span></span></span> to <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em"></span><span class="mord mathnormal">A</span></span></span></span></span> spendable with the signature of <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em"></span><span class="mord mathnormal">A</span></span></span></span></span>. Also, <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi></mrow><annotation encoding="application/x-tex">B</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em"></span><span class="mord mathnormal" style="margin-right:0.05017em">B</span></span></span></span></span> includes the spending condition <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>H</mi><mo stretchy="false">(</mo><mi>i</mi><mi>n</mi><mi>p</mi><mi>u</mi><mi>t</mi><mo stretchy="false">)</mo><mo>=</mo><mo>=</mo><mi>H</mi><mo stretchy="false">(</mo><mi>z</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">H(input) == H(z)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord mathnormal" style="margin-right:0.08125em">H</span><span class="mopen">(</span><span class="mord mathnormal">in</span><span class="mord mathnormal">p</span><span class="mord mathnormal">u</span><span class="mord mathnormal">t</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">==</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord mathnormal" style="margin-right:0.08125em">H</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.04398em">z</span><span class="mclose">)</span></span></span></span></span> based on the IPFS hash of the file. <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi></mrow><annotation encoding="application/x-tex">B</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em"></span><span class="mord mathnormal" style="margin-right:0.05017em">B</span></span></span></span></span> is also setting a time <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi></mrow><annotation encoding="application/x-tex">t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6151em"></span><span class="mord mathnormal">t</span></span></span></span></span> after which the transaction must be spent, otherwise, <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi></mrow><annotation encoding="application/x-tex">B</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em"></span><span class="mord mathnormal" style="margin-right:0.05017em">B</span></span></span></span></span> can redeem the locked funds. Last, <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi></mrow><annotation encoding="application/x-tex">B</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em"></span><span class="mord mathnormal" style="margin-right:0.05017em">B</span></span></span></span></span> sends the transaction to <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em"></span><span class="mord mathnormal">A</span></span></span></span></span> to sign it.</li><li><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em"></span><span class="mord mathnormal">A</span></span></span></span></span> signs the transaction to agree to the trade and commits it to the channel.</li><li><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em"></span><span class="mord mathnormal">A</span></span></span></span></span> reveals the <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>H</mi><mo stretchy="false">(</mo><mi>z</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">H(z)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord mathnormal" style="margin-right:0.08125em">H</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.04398em">z</span><span class="mclose">)</span></span></span></span></span> to issue the payment, which gives <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi></mrow><annotation encoding="application/x-tex">B</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em"></span><span class="mord mathnormal" style="margin-right:0.05017em">B</span></span></span></span></span> <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>H</mi><mo stretchy="false">(</mo><mi>z</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">H(z)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord mathnormal" style="margin-right:0.08125em">H</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.04398em">z</span><span class="mclose">)</span></span></span></span></span>. <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi></mrow><annotation encoding="application/x-tex">B</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em"></span><span class="mord mathnormal" style="margin-right:0.05017em">B</span></span></span></span></span> obtains <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>z</mi></mrow><annotation encoding="application/x-tex">z</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em"></span><span class="mord mathnormal" style="margin-right:0.04398em">z</span></span></span></span></span> through IPFS.</li></ol><p>This contract allowed an atomic swap of the file without the need to upload the file to Bitcoin. It requires both agents to be online which is a reasonable assumption for autonomous agents.
The protocol does not handle the security of the file.
Any party observing <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>H</mi><mo stretchy="false">(</mo><mi>z</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">H(z)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord mathnormal" style="margin-right:0.08125em">H</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.04398em">z</span><span class="mclose">)</span></span></span></span></span> can access <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>z</mi></mrow><annotation encoding="application/x-tex">z</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em"></span><span class="mord mathnormal" style="margin-right:0.04398em">z</span></span></span></span></span> without paying any price.
Hence, the protocol could be extended using GPG or other asymmetric encryption schemes.
In that case, <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em"></span><span class="mord mathnormal">A</span></span></span></span></span> could take <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi></mrow><annotation encoding="application/x-tex">B</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em"></span><span class="mord mathnormal" style="margin-right:0.05017em">B</span></span></span></span></span>&#x27;s public RSA key to encrypt <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>z</mi></mrow><annotation encoding="application/x-tex">z</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em"></span><span class="mord mathnormal" style="margin-right:0.04398em">z</span></span></span></span></span> and then store it on IPFS.
This would allow private trading of the file.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="mechanism-analysis">Mechanism analysis<a href="#mechanism-analysis" class="hash-link" aria-label="Direct link to Mechanism analysis" title="Direct link to Mechanism analysis">​</a></h2><p><strong>Players:</strong> <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em"></span><span class="mord mathnormal">A</span></span></span></span></span> and <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi></mrow><annotation encoding="application/x-tex">B</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em"></span><span class="mord mathnormal" style="margin-right:0.05017em">B</span></span></span></span></span> are the only players in the game. They have the same capabilities and pre-contract the same norms. Post-contract one agent has the obligation to pay for <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>z</mi></mrow><annotation encoding="application/x-tex">z</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em"></span><span class="mord mathnormal" style="margin-right:0.04398em">z</span></span></span></span></span> and the other has an obligation to provide <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>z</mi></mrow><annotation encoding="application/x-tex">z</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em"></span><span class="mord mathnormal" style="margin-right:0.04398em">z</span></span></span></span></span>. The contract is <em>atomic</em>. Hence, payment and delivery occur at the same time. However, there is a possible weakness in the contract. If <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em"></span><span class="mord mathnormal">A</span></span></span></span></span> reveals <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>H</mi><mo stretchy="false">(</mo><mi>z</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">H(z)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord mathnormal" style="margin-right:0.08125em">H</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.04398em">z</span><span class="mclose">)</span></span></span></span></span> without having the file stored on IPFS any more, <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi></mrow><annotation encoding="application/x-tex">B</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em"></span><span class="mord mathnormal" style="margin-right:0.05017em">B</span></span></span></span></span> will not be able to retrieve the file.</p><p><strong>Types:</strong> Both players have a valuation <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>v</mi><mo stretchy="false">(</mo><mi>z</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">v(z)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord mathnormal" style="margin-right:0.03588em">v</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.04398em">z</span><span class="mclose">)</span></span></span></span></span>. <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em"></span><span class="mord mathnormal">A</span></span></span></span></span> has private access to <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>z</mi></mrow><annotation encoding="application/x-tex">z</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em"></span><span class="mord mathnormal" style="margin-right:0.04398em">z</span></span></span></span></span>.</p><p><strong>Strategy:</strong> <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em"></span><span class="mord mathnormal">A</span></span></span></span></span> has three actions: not reveal <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>H</mi><mo stretchy="false">(</mo><mi>z</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">H(z)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord mathnormal" style="margin-right:0.08125em">H</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.04398em">z</span><span class="mclose">)</span></span></span></span></span>, reveal <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>H</mi><mo stretchy="false">(</mo><mi>z</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">H(z)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord mathnormal" style="margin-right:0.08125em">H</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.04398em">z</span><span class="mclose">)</span></span></span></span></span> and have <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>z</mi></mrow><annotation encoding="application/x-tex">z</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em"></span><span class="mord mathnormal" style="margin-right:0.04398em">z</span></span></span></span></span> accessible, and reveal <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>H</mi><mo stretchy="false">(</mo><mi>z</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">H(z)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord mathnormal" style="margin-right:0.08125em">H</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.04398em">z</span><span class="mclose">)</span></span></span></span></span> and have <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>z</mi></mrow><annotation encoding="application/x-tex">z</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em"></span><span class="mord mathnormal" style="margin-right:0.04398em">z</span></span></span></span></span> inaccessible. <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi></mrow><annotation encoding="application/x-tex">B</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em"></span><span class="mord mathnormal" style="margin-right:0.05017em">B</span></span></span></span></span> has two actions: prepare HTLC with a payment <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi></mrow><annotation encoding="application/x-tex">p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em"></span><span class="mord mathnormal">p</span></span></span></span></span> for <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em"></span><span class="mord mathnormal">A</span></span></span></span></span> or not. Assuming <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi></mrow><annotation encoding="application/x-tex">B</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em"></span><span class="mord mathnormal" style="margin-right:0.05017em">B</span></span></span></span></span>&#x27;s valuation of <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>v</mi><mi>B</mi></msub><mo stretchy="false">(</mo><mi>z</mi><mo stretchy="false">)</mo><mo>&gt;</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">v_B(z) &gt; 0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05017em">B</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.04398em">z</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:0.6444em"></span><span class="mord">0</span></span></span></span></span>, <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi></mrow><annotation encoding="application/x-tex">B</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em"></span><span class="mord mathnormal" style="margin-right:0.05017em">B</span></span></span></span></span> will propose a minimum payment. Since there is no proof of <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>z</mi></mrow><annotation encoding="application/x-tex">z</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em"></span><span class="mord mathnormal" style="margin-right:0.04398em">z</span></span></span></span></span> being available and the desired resource, <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi></mrow><annotation encoding="application/x-tex">B</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em"></span><span class="mord mathnormal" style="margin-right:0.05017em">B</span></span></span></span></span> has to account for this risk. The protocol could be improved by using concepts such as proof of replication <!-- -->[<!-- -->10<!-- -->]<!-- -->.
<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em"></span><span class="mord mathnormal">A</span></span></span></span></span> will only consider revealing <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>H</mi><mo stretchy="false">(</mo><mi>z</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">H(z)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord mathnormal" style="margin-right:0.08125em">H</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.04398em">z</span><span class="mclose">)</span></span></span></span></span> in the proposed HTLC if <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mo>≥</mo><msub><mi>v</mi><mi>A</mi></msub><mo stretchy="false">(</mo><mi>z</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">p \geq v_A(z)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8304em;vertical-align:-0.1944em"></span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">≥</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">A</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.04398em">z</span><span class="mclose">)</span></span></span></span></span>. Moreover, <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em"></span><span class="mord mathnormal">A</span></span></span></span></span> might cheat <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi></mrow><annotation encoding="application/x-tex">B</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em"></span><span class="mord mathnormal" style="margin-right:0.05017em">B</span></span></span></span></span> by not making <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>z</mi></mrow><annotation encoding="application/x-tex">z</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em"></span><span class="mord mathnormal" style="margin-right:0.04398em">z</span></span></span></span></span> available. In case <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em"></span><span class="mord mathnormal">A</span></span></span></span></span> expects future trades with <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi></mrow><annotation encoding="application/x-tex">B</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em"></span><span class="mord mathnormal" style="margin-right:0.05017em">B</span></span></span></span></span>, it has a motivation to actually provide <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>z</mi></mrow><annotation encoding="application/x-tex">z</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em"></span><span class="mord mathnormal" style="margin-right:0.04398em">z</span></span></span></span></span>. <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi></mrow><annotation encoding="application/x-tex">B</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em"></span><span class="mord mathnormal" style="margin-right:0.05017em">B</span></span></span></span></span> might promise a higher pay for future interactions and adjust his valuation function to the resource <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>z</mi></mrow><annotation encoding="application/x-tex">z</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em"></span><span class="mord mathnormal" style="margin-right:0.04398em">z</span></span></span></span></span> provided by <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em"></span><span class="mord mathnormal">A</span></span></span></span></span> to a higher value since <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em"></span><span class="mord mathnormal">A</span></span></span></span></span> is based on previous direct experience trusted.</p><p><strong>Utility:</strong> Utilities depend on the combination of strategies.</p><ul><li><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi></mrow><annotation encoding="application/x-tex">B</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em"></span><span class="mord mathnormal" style="margin-right:0.05017em">B</span></span></span></span></span> proposes HTLC with payment <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi></mrow><annotation encoding="application/x-tex">p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em"></span><span class="mord mathnormal">p</span></span></span></span></span> and <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em"></span><span class="mord mathnormal">A</span></span></span></span></span> reveals <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>H</mi><mo stretchy="false">(</mo><mi>z</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">H(z)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord mathnormal" style="margin-right:0.08125em">H</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.04398em">z</span><span class="mclose">)</span></span></span></span></span> with <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>z</mi></mrow><annotation encoding="application/x-tex">z</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em"></span><span class="mord mathnormal" style="margin-right:0.04398em">z</span></span></span></span></span> available: <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>u</mi><mi>A</mi></msub><mo>=</mo><mi>p</mi><mo>−</mo><msub><mi>v</mi><mi>A</mi></msub><mo stretchy="false">(</mo><mi>z</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">u_A = p - v_A(z)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em"></span><span class="mord"><span class="mord mathnormal">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">A</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:0.7778em;vertical-align:-0.1944em"></span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">A</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.04398em">z</span><span class="mclose">)</span></span></span></span></span> and <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>u</mi><mi>B</mi></msub><mo>=</mo><msub><mi>v</mi><mi>B</mi></msub><mo stretchy="false">(</mo><mi>z</mi><mo stretchy="false">)</mo><mo>−</mo><mi>p</mi></mrow><annotation encoding="application/x-tex">u_B = v_B(z) - p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em"></span><span class="mord"><span class="mord mathnormal">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05017em">B</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05017em">B</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.04398em">z</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em"></span><span class="mord mathnormal">p</span></span></span></span></span>. Under the assumption that <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em"></span><span class="mord mathnormal">A</span></span></span></span></span> does not loose anything from selling <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>z</mi></mrow><annotation encoding="application/x-tex">z</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em"></span><span class="mord mathnormal" style="margin-right:0.04398em">z</span></span></span></span></span>.</li><li><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi></mrow><annotation encoding="application/x-tex">B</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em"></span><span class="mord mathnormal" style="margin-right:0.05017em">B</span></span></span></span></span> proposes HTLC with payment <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi></mrow><annotation encoding="application/x-tex">p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em"></span><span class="mord mathnormal">p</span></span></span></span></span> and <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em"></span><span class="mord mathnormal">A</span></span></span></span></span> reveals <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>H</mi><mo stretchy="false">(</mo><mi>z</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">H(z)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord mathnormal" style="margin-right:0.08125em">H</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.04398em">z</span><span class="mclose">)</span></span></span></span></span> with <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>z</mi></mrow><annotation encoding="application/x-tex">z</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em"></span><span class="mord mathnormal" style="margin-right:0.04398em">z</span></span></span></span></span> unavailable: <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>u</mi><mi>A</mi></msub><mo>=</mo><mi>p</mi><mo>−</mo><msub><mi>v</mi><mi>A</mi></msub><mo stretchy="false">(</mo><mi>z</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">u_A = p - v_A(z)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em"></span><span class="mord"><span class="mord mathnormal">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">A</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:0.7778em;vertical-align:-0.1944em"></span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">A</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.04398em">z</span><span class="mclose">)</span></span></span></span></span> and <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>u</mi><mi>B</mi></msub><mo>=</mo><mn>0</mn><mo>−</mo><mi>p</mi></mrow><annotation encoding="application/x-tex">u_B = 0 - p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em"></span><span class="mord"><span class="mord mathnormal">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05017em">B</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em"></span><span class="mord">0</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em"></span><span class="mord mathnormal">p</span></span></span></span></span>.</li><li><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi></mrow><annotation encoding="application/x-tex">B</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em"></span><span class="mord mathnormal" style="margin-right:0.05017em">B</span></span></span></span></span> proposes HTLC with payment <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi></mrow><annotation encoding="application/x-tex">p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em"></span><span class="mord mathnormal">p</span></span></span></span></span> and <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em"></span><span class="mord mathnormal">A</span></span></span></span></span> does not reveal <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>H</mi><mo stretchy="false">(</mo><mi>z</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">H(z)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord mathnormal" style="margin-right:0.08125em">H</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.04398em">z</span><span class="mclose">)</span></span></span></span></span>: <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>u</mi><mi>A</mi></msub><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">u_A = 0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em"></span><span class="mord"><span class="mord mathnormal">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">A</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:0.6444em"></span><span class="mord">0</span></span></span></span></span> and <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>u</mi><mi>B</mi></msub><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">u_B = 0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em"></span><span class="mord"><span class="mord mathnormal">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05017em">B</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:0.6444em"></span><span class="mord">0</span></span></span></span></span>.</li><li><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi></mrow><annotation encoding="application/x-tex">B</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em"></span><span class="mord mathnormal" style="margin-right:0.05017em">B</span></span></span></span></span> does not propose HTLC: <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>u</mi><mi>A</mi></msub><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">u_A = 0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em"></span><span class="mord"><span class="mord mathnormal">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">A</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:0.6444em"></span><span class="mord">0</span></span></span></span></span> and <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>u</mi><mi>B</mi></msub><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">u_B = 0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em"></span><span class="mord"><span class="mord mathnormal">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05017em">B</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:0.6444em"></span><span class="mord">0</span></span></span></span></span>.</li></ul><p><strong>Social choice:</strong> Since <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi></mrow><annotation encoding="application/x-tex">B</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em"></span><span class="mord mathnormal" style="margin-right:0.05017em">B</span></span></span></span></span> proposes the contract, <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi></mrow><annotation encoding="application/x-tex">B</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em"></span><span class="mord mathnormal" style="margin-right:0.05017em">B</span></span></span></span></span> can set the social choice function. In this case, a single parameter domain is useful. The utility analysis shows that <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi></mrow><annotation encoding="application/x-tex">p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em"></span><span class="mord mathnormal">p</span></span></span></span></span> has the condition <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>v</mi><mi>A</mi></msub><mo stretchy="false">(</mo><mi>z</mi><mo stretchy="false">)</mo><mo>≤</mo><mi>p</mi><mo>≤</mo><msub><mi>v</mi><mi>B</mi></msub><mo stretchy="false">(</mo><mi>z</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">v_A(z) \leq p \leq v_B(z)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">A</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.04398em">z</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:0.8304em;vertical-align:-0.1944em"></span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05017em">B</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.04398em">z</span><span class="mclose">)</span></span></span></span></span>. Since <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi></mrow><annotation encoding="application/x-tex">B</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em"></span><span class="mord mathnormal" style="margin-right:0.05017em">B</span></span></span></span></span> is not able to be sure that <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>z</mi></mrow><annotation encoding="application/x-tex">z</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em"></span><span class="mord mathnormal" style="margin-right:0.04398em">z</span></span></span></span></span> is available, <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi></mrow><annotation encoding="application/x-tex">p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em"></span><span class="mord mathnormal">p</span></span></span></span></span> will be low in the first tries as <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi></mrow><annotation encoding="application/x-tex">B</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em"></span><span class="mord mathnormal" style="margin-right:0.05017em">B</span></span></span></span></span> tries to manage his risk exposure. However, <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi></mrow><annotation encoding="application/x-tex">B</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em"></span><span class="mord mathnormal" style="margin-right:0.05017em">B</span></span></span></span></span> could argue that <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em"></span><span class="mord mathnormal">A</span></span></span></span></span> might be interested in future trades and include this as part of his utility function as an expected value. Hence, <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi></mrow><annotation encoding="application/x-tex">B</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em"></span><span class="mord mathnormal" style="margin-right:0.05017em">B</span></span></span></span></span> would only propose a contract if <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mo>&lt;</mo><mo>&lt;</mo><msub><mi>v</mi><mi>B</mi></msub><mo stretchy="false">(</mo><mi>z</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">p &lt;&lt; v_B(z)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7335em;vertical-align:-0.1944em"></span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">&lt;&lt;</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05017em">B</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.04398em">z</span><span class="mclose">)</span></span></span></span></span> since otherwise the risk is too high.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="references">References<a href="#references" class="hash-link" aria-label="Direct link to References" title="Direct link to References">​</a></h2><p>[<!-- -->1<!-- -->]<!-- --> S. Fatima, S. Kraus, and M. Wooldridge, <em>Principles of Automated Negotiation</em>. Cambridge: Cambridge University Press, 2014 <!-- -->[<!-- -->Online<!-- -->]<!-- -->. Available: <a href="http://ebooks.cambridge.org/ref/id/CBO9780511751691" target="_blank" rel="noopener noreferrer">http://ebooks.cambridge.org/ref/id/CBO9780511751691</a></p><p>[<!-- -->2<!-- -->]<!-- --> S. Nakamoto, &quot;Bitcoin: A peer-to-peer electronic cash system,&quot; 2008.</p><p>[<!-- -->3<!-- -->]<!-- --> Bitcoin Wiki, &quot;Script.&quot; 2018 <!-- -->[<!-- -->Online<!-- -->]<!-- -->. Available: <a href="https://en.bitcoin.it/wiki/Script%7B#%7DOpcodes" target="_blank" rel="noopener noreferrer">https://en.bitcoin.it/wiki/Script{<!-- -->\<!-- -->#<!-- -->}Opcodes</a>. <!-- -->[<!-- -->Accessed: 27-Jun-2018<!-- -->]</p><p>[<!-- -->4<!-- -->]<!-- --> N. Szabo, &quot;Formalizing and Securing Relationships on Public Networks.&quot; 1997 <!-- -->[<!-- -->Online<!-- -->]<!-- -->. Available: <a href="http://ojphi.org/ojs/index.php/fm/article/view/548/469" target="_blank" rel="noopener noreferrer">http://ojphi.org/ojs/index.php/fm/article/view/548/469</a>. <!-- -->[<!-- -->Accessed: 07-Apr-2017<!-- -->]</p><p>[<!-- -->5<!-- -->]<!-- --> T. W. Sandholm and V. R. Lesser, &quot;Leveled Commitment Contracts and Strategic Breach,&quot; <em>Games and Economic Behavior</em>, vol. 35, nos. 1-2, pp. 212--270, 2001.</p><p>[<!-- -->6<!-- -->]<!-- --> N. Nisan, T. Roughgarden, E. Tardos, and V. V. Vazirani, <em>Algorithmic Game Theory</em>, vol. 1. Cambridge: Cambridge University Press, 2007, pp. 1--754 <!-- -->[<!-- -->Online<!-- -->]<!-- -->. Available: <!-- -->[http://portal.acm.org/citation.cfm?doid=1785414.1785439 http://ebooks.cambridge.org/ref/id/CBO9780511800481]<!-- -->(<a href="http://portal.acm.org/citation.cfm?doid=1785414.1785439" target="_blank" rel="noopener noreferrer">http://portal.acm.org/citation.cfm?doid=1785414.1785439</a> <a href="http://ebooks.cambridge.org/ref/id/CBO9780511800481" target="_blank" rel="noopener noreferrer">http://ebooks.cambridge.org/ref/id/CBO9780511800481</a>)</p><p>[<!-- -->7<!-- -->]<!-- --> N. Nisan and A. Ronen, &quot;Algorithmic Mechanism Design,&quot; <em>Games and Economic Behavior</em>, vol. 35, nos. 1-2, pp. 166--196, Apr. 2001 <!-- -->[<!-- -->Online<!-- -->]<!-- -->. Available: <a href="http://linkinghub.elsevier.com/retrieve/pii/S089982569990790X" target="_blank" rel="noopener noreferrer">http://linkinghub.elsevier.com/retrieve/pii/S089982569990790X</a></p><p>[<!-- -->8<!-- -->]<!-- --> Bitcoin Wiki, &quot;Hashed Timelock Contracts.&quot; 2018 <!-- -->[<!-- -->Online<!-- -->]<!-- -->. Available: <a href="https://en.bitcoin.it/wiki/Hashed%7B_%7DTimelock%7B_%7DContracts" target="_blank" rel="noopener noreferrer">https://en.bitcoin.it/wiki/Hashed{<!-- -->\<!-- -->_<!-- -->}Timelock{<!-- -->\<!-- -->_<!-- -->}Contracts</a>. <!-- -->[<!-- -->Accessed: 28-Jun-2018<!-- -->]</p><p>[<!-- -->9<!-- -->]<!-- --> I. Bentov <em>et al.</em>, &quot;Tesseract: Real-Time Cryptocurrency Exchange using Trusted Hardware,&quot; 2017 <!-- -->[<!-- -->Online<!-- -->]<!-- -->. Available: <a href="http://www.cs.cornell.edu/%7B~%7Diddo/RTExchSGX.pdf" target="_blank" rel="noopener noreferrer">http://www.cs.cornell.edu/{<!-- -->~<!-- -->}iddo/RTExchSGX.pdf</a></p><p>[<!-- -->10<!-- -->]<!-- --> A. Juels and B. Kaliski Jr., &quot;Pors: Proofs of retrievability for large files,&quot; <em>Proceedings of the ACM Conference on Computer and Communications Security</em>, pp. 584--597, 2007 <!-- -->[<!-- -->Online<!-- -->]<!-- -->. Available: <a href="http://www.scopus.com/inward/record.url?eid=2-s2.0-74049101079%7B%5C&amp;%7DpartnerID=40%7B%5C&amp;%7Dmd5=83cf075b3704d4fe5bfb2ccf38c39362" target="_blank" rel="noopener noreferrer">http://www.scopus.com/inward/record.url?eid=2-s2.0-74049101079{<!-- -->\<!-- -->&amp;}partnerID=40{<!-- -->\<!-- -->&amp;}md5=83cf075b3704d4fe5bfb2ccf38c39362</a></p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/blockchain">blockchain</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/de-fi">DeFi</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/mechanism-design">mechanism design</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/smart-contracts">smart contracts</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/bitcoin">Bitcoin</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/ethereum-python-integration">Integrating Python and Ethereum</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2017-02-14T00:00:00.000Z" itemprop="datePublished">February 14, 2017</time> · <!-- -->5 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://harz.dev" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/nud3l.png" alt="Dominik Harz"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://harz.dev" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Dominik Harz</span></a></div><small class="avatar__subtitle" itemprop="description">CTO Interlay</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>In Ethereum and other blockchains there are still a lot of proof of concept implementation and developers trying out how to cope with the new concepts. As part of the dInvest post series I was also looking into Ethereum and trying to implement a hedge fund in a blockchain. In a previous post I discussed how to get a quantitative framework in python up and running. In this post I will write how to integrate python programs with Ethereum smart contracts. For one reason or another you might be also faced with the issue, that although Ethereum offers a Turing-complete language not everything is actually doable there.</p><p>Let&#x27;s say you have created one of the <a href="/www.ethereum.org/greeter">simple tutorial contracts in Ethereum</a> and now want to look at something more advanced. I personally liked the <a href="https://medium.com/zeppelin-blog/the-hitchhikers-guide-to-smart-contracts-in-ethereum-848f08001f05##.3dxx4rysl" target="_blank" rel="noopener noreferrer">Hitchhiker&#x27;s Guide to Smart Contracts</a> by Manuel Aráoz to get started with more complex code, setup testrpc, and truffle. Take a look at it.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="dinvest-smart-contract">dInvest smart contract<a href="#dinvest-smart-contract" class="hash-link" aria-label="Direct link to dInvest smart contract" title="Direct link to dInvest smart contract">​</a></h2><p>dInvest is composed of one smart contract that is responsible for making investments, verifying investment
criteria and distribution of returns. The contract exposes public functions to create new investments and
for withdrawal which will act as main functions of a hedge fund. Users of the hedge fund are identified
by their Ethereum address which is equivalent for the public key. Suggestion of investment strategies and
strategy execution are done in different agents that also have Ethereum addresses. These agents are set by
the contract creator only.
When a user is creating an investment it is possible to specify a list of industry sectors identified by a
two digit number based on the Standard Industrial Classification codes. These sectors will be identified
as a black list when making the investments. Therefore user have the ability control the sectors which the
hedge fund will invest on.</p><p>The contract can be found in <a href="/github.com/nud3l/dInvest/blob/master/solidity/contracts/HedgeContract1.sol">the GitHub repo</a>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="interaction-with-smart-contracts">Interaction with smart contracts<a href="#interaction-with-smart-contracts" class="hash-link" aria-label="Direct link to Interaction with smart contracts" title="Direct link to Interaction with smart contracts">​</a></h2><p>To interact with smart contracts, there are a couple of option including RPC or a JavaScript API. I found the easiest way to interact with Ethereum smart contracts from other programs (like python programs) was using their <a href="/github.com/ethereum/wiki/wiki/JavaScript-API">web3 JavaScript API</a>. As the majority of dInvest is written in python, I wanted to stick to the language and not include JS as well. Luckily, there is a <a href="/github.com/pipermerriam/web3.py">web3 implementation in python</a>. To get it up and running for the dInvest setting I switched to the virtualenv, where I also installed zipline and then install web3 simply with <code>pip install web3</code>.</p><p>Using web3, there are three steps to get you up and running to interact with your smart contract:</p><ol><li>Getting your ABI</li><li>Setup the RPC connection</li><li>Interact with the smart contract</li></ol><p>In the next sections, I will go into detail how to achieve the three steps. I am using this mostly as a python module for other programs. In the end our python module structure might look like this:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">contract</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|-- __init__.py</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|-- ContractHandler.py</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|-- your-contract-name.json</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="getting-your-abi">Getting your ABI<a href="#getting-your-abi" class="hash-link" aria-label="Direct link to Getting your ABI" title="Direct link to Getting your ABI">​</a></h2><p>Now, to interact with any smart contract you need the <a href="/github.com/ethereum/wiki/wiki/Ethereum-Contract-ABI">Application Binary Interface(ABI)</a> defined by the contract. The ABI is a static, strongly typed interface. Whenever you create a new contract or change an existing one, chances are your ABI changes as well. In my experience the easiest way to get the current ABI of a smart contract (which might be yours or any contract you have the source code available) is to go to <a href="https://ethereum.github.io/browser-solidity/" target="_blank" rel="noopener noreferrer">https://ethereum.github.io/browser-solidity/</a> and copy/paste your code there. Then press the &quot;Compile&quot; button on the upper right side and copy the entire string in the &quot;Interface&quot; field into a <code>your-contract-name.json</code> file. Once you have that JSON, your web3 interface will know how to interact with the contract.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="setting-up-the-rpc-provider">Setting up the RPC provider<a href="#setting-up-the-rpc-provider" class="hash-link" aria-label="Direct link to Setting up the RPC provider" title="Direct link to Setting up the RPC provider">​</a></h2><p>As a next step you will need to connect to the RPC provider. In your python file (e.g. <code>ContractHandler.py</code>) include those lines of code:</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> web3 </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> Web3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> TestRPCProvider</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">class</span><span class="token plain"> </span><span class="token class-name">ContractHandler</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">__init__</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">web3 </span><span class="token operator">=</span><span class="token plain"> Web3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">RPCProvider</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">host</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;localhost&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> port</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;8545&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">with</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">open</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token builtin" style="color:rgb(189, 147, 249)">str</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">path</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">join</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">dir_path</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;contract_abi.json&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;r&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> abi_definition</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">abi </span><span class="token operator">=</span><span class="token plain"> json</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">load</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">abi_definition</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">contract_address </span><span class="token operator">=</span><span class="token plain"> your_contract_address</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">contract </span><span class="token operator">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">web3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">eth</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">contract</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">abi</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">contract_address</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>I prefer having my configurations in a separate file. There are many ways to do it and it seems like there is no standard in python. I guess using a txt file is not the best option though and I plan to switch to yml soon. See also here <a href="https://martin-thoma.com/configuration-files-in-python/" target="_blank" rel="noopener noreferrer">https://martin-thoma.com/configuration-files-in-python/</a>. Make sure to run your favorite Ethereum client before starting your program (e.g. <code>geth --rpc</code>).</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="interacting-with-the-smart-contract">Interacting with the smart contract<a href="#interacting-with-the-smart-contract" class="hash-link" aria-label="Direct link to Interacting with the smart contract" title="Direct link to Interacting with the smart contract">​</a></h2><p>Note: Before interacting with your own account you need to unlock it first. This is achieved in web3 via:</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">web3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">personal</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">unlockAccount</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">your_ethereum_account</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> your_ethereum_password</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>There are some standard web3 calls you can make, like getting the current balance of an account in wei:</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">wei_balance </span><span class="token operator">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">web3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">eth</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">getBalance</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">some_ethereum_address</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In case you want to call a function in the contract you can do this by calling the command as defined by the contract ABI. In our dInvest example there is a contract call which returns the blacklisted companies for our sustainable investment. It is callable with:</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">blacklist </span><span class="token operator">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">contract</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">call</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">blackListCompanies</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>There are some more examples in the <a href="https://github.com/nud3l/dInvest/blob/master/trading/contract/ContractHandler.py" target="_blank" rel="noopener noreferrer">GitHub code available</a>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="final-note">Final note<a href="#final-note" class="hash-link" aria-label="Direct link to Final note" title="Direct link to Final note">​</a></h2><p>As a final note, I would like to point out that there are other blockchain solutions like <a href="/hyperledger-fabric.readthedocs.io/en/latest/">Hyperledger Fabric</a> or <a href="/tendermint.com">Tendermint</a> that aim to solve issues around compatibility with other programming language, transaction throughput etc. As they are permissioned blockchains I haven&#x27;t yet given them a try, but might be interesting to take a look at.</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/dinvest">dinvest</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/blockchain">blockchain</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/ethereum">ethereum</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/python">python</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/quantitative-finance-zipline">Quantitative finance with zipline</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2017-02-10T00:00:00.000Z" itemprop="datePublished">February 10, 2017</time> · <!-- -->10 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://harz.dev" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/nud3l.png" alt="Dominik Harz"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://harz.dev" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Dominik Harz</span></a></div><small class="avatar__subtitle" itemprop="description">CTO Interlay</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>As stated in the <!-- -->[dInvest post series]<!-- -->({% post_url 2017-01-10-dinvest %}) the idea is to build a hedge fund in a blockchain. Due to computational limitations, it is not feasible to implement investment agents in the blockchain. In dInvest an investment agent should do the following: (1) Get a list of all available financial assets to trade; (2) based on the data given (i.e. financial data and fundamentals data) make a recommendation which assets to buy; (3) keep track of which assets the agent is currently holding; and (4) send the recommended assets to buy to the blockchain. In this blog post I will cover the first three tasks. But what does a hedge fund actually do and how do financial investment strategies look like? I had taken some courses in my undergrad on international finance, but as a computer scientist I had to learn some new concepts while doing this project.</p><p>Financial investments can take different forms. A hedge fund offers multiple individuals to acquire a part of the pooled investment, which itself invests in publicly
traded financial assets. It is measured according to its absolute returns <!-- -->[1]<!-- -->. A manager administrates the
investment of the hedge fund and takes the decisions to buy, sell, or hold financial assets to balance absolute
returns and risks. A hedge fund may apply different strategies. Hedge funds can follow one specific strategy, mix
established strategies, or create a fund out of hedge funds to diversify <!-- -->[2]<!-- -->. The majority of hedge fund
strategies try to optimize the absolute return and risk based on financial indicators of the assets to be invested
in. An overview of the different strategies that are currently applied by different hedge funds is provided by
HFR, Inc in <!-- -->[3]<!-- -->. Measuring the performance of hedge funds as well as specific influence factors is a wide
research area, which is covered in more detail in our report.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="measuring-success-of-investments">Measuring success of investments<a href="#measuring-success-of-investments" class="hash-link" aria-label="Direct link to Measuring success of investments" title="Direct link to Measuring success of investments">​</a></h2><p>A common standard in literature and the investment practice to compare hedge funds is based on
their absolute returns, Sharpe ratio, alpha and beta as well as a comparison to benchmarks <!-- -->[2]<!-- -->.</p><ul><li>Returns: The return of the fund is influenced by how well the strategy is able to determine assets that are increasing (for long buys) or decreasing (for short buys) in value over time.</li><li>Sharpe: With the Sharpe ratio one can determine the return in respect to the risk involved. The Sharpe ratio is calculated by dividing the sum of the asset return and a benchmark return by the standard deviation of the asset return. The higher the Sharpe ratio, the higher the return with the same risk or the lower the risk with same return.</li><li>Alpha: The alpha value expresses the risk-adjusted performance of the fund in comparison to a benchmark. An alpha of zero means exact performance as the benchmark. A positive value indicates outperforming the benchmark and a negative value represents falling behind the benchmark.</li><li>Beta: The beta value shows the volatility of the fund in comparison to a benchmark. The beta value baseline is one and represents the same volatility as the benchmark. A value below one indicates a lower volatility and consequently a value above one a higher volatility than the benchmark.</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="quantitiative-finance">Quantitiative finance<a href="#quantitiative-finance" class="hash-link" aria-label="Direct link to Quantitiative finance" title="Direct link to Quantitiative finance">​</a></h2><p>To implement an investment strategy, certain rule sets are developed and applied. Quantitative finance
”translates” economic models into the mathematical world and allows to apply for example stochastic
analysis over shares or calculate the value of derivatives <!-- -->[4]<!-- -->. Quantitative finance techniques express
investment strategies in mathematical formulas and thus enables a translation into an algorithm <!-- -->[4]<!-- -->.
When starting out with dInvest, we were looking into existing quantitative frameworks, that offer us (1) a simulation environment
to test our algorithms without using actual money, (2) realistic conditions of the trading market, such as
fees and process delays, (3) is able to trade shares and derivatives based on historical data to test our
algorithm, (4) provide little delay (lower than 10 minutes) in trading current assets, and (5) is able to be
controlled using a programming language (such as Python, Java, or Scala). We evaluated several solutions
decided to use the open source implementation of the Quantopian framework <a href="/github.com/quantopian/zipline">zipline</a>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="getting-started-with-zipline">Getting started with zipline<a href="#getting-started-with-zipline" class="hash-link" aria-label="Direct link to Getting started with zipline" title="Direct link to Getting started with zipline">​</a></h2><p>Zipline is based on python and is able to run with python 2 and 3. Quantopian has created a <a href="/www.zipline.io/beginner-tutorial.html">beginners tutorial</a> on their website. Before going into the details of zipline, let us look into how to set it up locally. Note: I will be using python3 throughout this post.
To install zipline you first need all the required C extensions. For Debian based distributions use the command shown below, otherwise there are some more details <a href="/www.zipline.io/install.html">provided here</a>.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo apt-get install libatlas-base-dev python-dev gfortran pkg-config libfreetype6-dev</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>I then created a virtual environment for Zipline. If you have never setup a virtualenv follow <a href="http://docs.python-guide.org/en/latest/dev/virtualenvs/" target="_blank" rel="noopener noreferrer">this tutorial</a>. In case you want to use pyhton3 like me, make sure to use the <code>python3</code> executable. Also, when trying python2 I ran into a couple of issues as Linux Mint uses older versions of python2, which seem to be incompatible with the required version of numpy. When you setup your virtualenv, run <code>pip install zipline</code> from the terminal with your virtualenv . This will install all the required packages including numpy and most likely take some time.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-first-investment-algorithm">The first investment algorithm<a href="#the-first-investment-algorithm" class="hash-link" aria-label="Direct link to The first investment algorithm" title="Direct link to The first investment algorithm">​</a></h2><p>In the <code>/zipline/examples</code> folder you will find some example algorithms to try out. In their beginners tutorial the zipline authors describe some of the algorithms, how they are generally structured and how to execute them. I will go into more detail about having a value investment algorithm and not take one of the example algorithms.</p><p>The algorithm to be implemented is inspired by Benjamin Graham <!-- -->[6]</p><ol><li>Select shares and derivatives of companies with a market capitalization of minimum 100 million dollars</li><li>Determine the SIC code of each asset <!-- -->[5]<!-- --> and exclude the ones contained in the blacklist from the hedge fund</li><li>Based on the sectors of the companies find the two sectors with the price of assets per earning ratio (PE ratio)</li><li>Invest every month in all the companies listed in the two sectors</li></ol><p>Let&#x27;s take a look at our <a href="https://github.com/nud3l/dInvest/blob/master/trading/recommender/InvestHandlerSimple.py" target="_blank" rel="noopener noreferrer">algorithm</a>.
It is basically taken from the web-based version of zipline called Quantopian and can be found <a href="https://www.quantopian.com/posts/grahamfundmantals-algo-simple-screening-on-benjamin-graham-number-fundamentals" target="_blank" rel="noopener noreferrer">here</a>. I have tried to include quite some comments, so if you are familiar with python then the code should be quite readable. Zipline does not include the full functionality and data to realize the investment algorithm. The market capitalization data, sector codes, and PE ratio are not accessible from zipline. For a quick overview of the current code and the changes I made, I will go through the main functions. Also, please note that I only used free sources of financial data. There seem to be a lot of other sources available, but they have their price tag.</p><p><code>initialize(context)</code> Defines the number of sectors we are interested in and also schedules to execution of our algorithm for back-testing.</p><p><code>rebalance(context, data)</code> This essentially takes to selected assets and distributes them evenly into our portfolio.</p><p><code>get_fundamentals(context, data)</code> In Quantopian this is fairly easy, since the Morningstar fundamentals dataset is included. However, in zipline I had to find a workaround. Quandl offers the SF0 fundamentals for free: <a href="/www.quandl.com/data/SF0-Free-US-Fundamentals-Data">www.quandl.com/data/SF0-Free-US-Fundamentals-Data</a>. To get a full view of the data, I choose to download the whole data as a CSV file and automated the process. An example of how to do this can be found in the <code>TradeHandler.getData(self)</code> function <a href="https://github.com/nud3l/dInvest/blob/master/trading/trader/TradeHandler.py" target="_blank" rel="noopener noreferrer">here</a>.</p><p><code>get_sectors(key)</code> Again, this is included in Quantopian, but needs a manual workaround. To get the sector codes it is quite simple. You need to download a txt file, which includes the sector codes and the function will read them into a dict.</p><p><code>get_sector_code()</code> Also, this part is included in Quantopian. Here we download a JSON file to get a mapping of sector codes to the financial assets we are trading.</p><p>To analyse the performance of the investment algorithm the absolute returns, Sharpe, alpha, and beta for the
period of January 1, 2009 to November 15, 2016 is compared. The investment algorithm uses the Quandl
financial data i.e. opening and closing prices of specific assets during that period <!-- -->[8]<!-- -->. The algorithm is executed
multiple times. First, no sectors are excluded and second, an
exclusion list based on sectors is used. Defense, beer and alcohol, tobacco, and coal industry are excluded based
on ESG criteria and common practices <!-- -->[9]<!-- -->.
The first graph in the figure below presents the returns achieved by the unrestricted
algorithm, the algorithm with single excluded sectors, and the benchmark return. These returns show that
unrestricted and single excluded algorithms have overall a higher profit than the benchmark. The second graph in the figure
displays a combination of two excluded sectors and the benchmark return, while the third graph elaborates on the
combinations of three and all four sectors excluded.
A single or combination of exclusions constantly perform better than the benchmark until
beginning of 2012. Then the unrestricted algorithm as well as the single exclusion of defense and alcohol
exclusion and also the combination of tobacco and coal, defense and alcohol, defense and coal exclusions
drop until they recover in 2014. The other single and combination algorithms do not show this drop, but also
have a strong increase in returns in 2014. Then all variations show high volatility. The drop in 2012 in the
unrestricted algorithm is caused by three of the sectors it is investing in. When tobacco is restricted, there is
no strong drop in 2012. However, if not also in combination defense and/or coal is restricted the algorithm
selects either of the two industries instead and another drop occurs. In the third graph of the figure these exclusions are
combined and no significant drop occurs, however the volatility remains.</p><img loading="lazy" src="{{ site.url }}/images/blog/dinvest/investment_return_single.png" alt="" width="550" class="img_ev3q"><img loading="lazy" src="{{ site.url }}/images/blog/dinvest/investment_return_double.png" alt="" width="550" class="img_ev3q"><img loading="lazy" src="{{ site.url }}/images/blog/dinvest/investment_return_triple.png" alt="" width="550" class="img_ev3q"><p>There is further analysis and discussion of the results in our <a href="https://goo.gl/T74EGE" target="_blank" rel="noopener noreferrer">report</a>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="references">References<a href="#references" class="hash-link" aria-label="Direct link to References" title="Direct link to References">​</a></h2><ol><li>D. Harper. (2016) Hedge funds hunt for upside, regardless of the market. <!-- -->[Online]<!-- -->. Available: <a href="http://www.investopedia.com/articles/03/112603.asp" target="_blank" rel="noopener noreferrer">http://www.investopedia.com/articles/03/112603.asp</a></li><li>M. Agarwal, Hedge Fund Strategies. John Wiley &amp; Sons, Inc., 2009, pp. 45–55. ISBN 9781118258187. <!-- -->[Online]<!-- -->. Available: <a href="http://dx.doi.org/10.1002/9781118258187.ch4" target="_blank" rel="noopener noreferrer">http://dx.doi.org/10.1002/9781118258187.ch4</a></li><li>Hedge Fund Research. (2016) HFR hedge fund strategy classification system. <!-- -->[Online]<!-- -->. Available: <a href="https://www.hedgefundresearch.com/hfr-hedge-fund-strategy-classification-system" target="_blank" rel="noopener noreferrer">https://www.hedgefundresearch.com/hfr-hedge-fund-strategy-classification-system</a></li><li>P. Wilmott, Paul Wilmott on quantitative finance. John Wiley &amp; Sons, 2013.</li><li>U.S.D. of Labor. (2016) SIC division structure. <!-- -->[Online]<!-- -->. Available: <a href="https://www.osha.gov/pls/imis/sic_manual.html" target="_blank" rel="noopener noreferrer">https://www.osha.gov/pls/imis/sic_manual.html</a></li><li>B. Graham and D. Dodd, Security Analysis: Sixth Edition, ser. Security Analysis Prior Editions. McGraw-Hill Education, 2008.</li><li>Quantopian. (2016) zipline: Pythonic algorithmic trading library. <!-- -->[Online]<!-- -->. Available: <a href="https://github.com/quantopian/zipline/" target="_blank" rel="noopener noreferrer">https://github.com/quantopian/zipline/</a></li><li>Quandl. (2016) Quandl: financial database. <!-- -->[Online]<!-- -->. Available: <a href="https://www.quandl.com/browse?idx=database-browser" target="_blank" rel="noopener noreferrer">https://www.quandl.com/browse?idx=database-browser</a></li><li>J. R. Evans and D. Peiris, “The relationship between environmental social governance factors and stock returns,” UNSW Australian School of Business Research Paper No. 2010ACTL02, 2010.</li></ol></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/quant">quant</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/finance">finance</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/zipline">zipline</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/python">python</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/breaking-captchas">Breaking captchas: Using deep learning to automatically break CAPTCHAs</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2017-01-12T00:00:00.000Z" itemprop="datePublished">January 12, 2017</time> · <!-- -->13 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://www.linkedin.com/in/tharidu-fernando/" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Tharidu Fernando</span></a></div></div></div></div><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://www.linkedin.com/in/akash13singh/" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Akash Singh</span></a></div></div></div></div><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://harz.dev" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/nud3l.png" alt="Dominik Harz"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://harz.dev" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Dominik Harz</span></a></div><small class="avatar__subtitle" itemprop="description">CTO Interlay</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>Completely Automated Public Turing test to tell Computers and Humans Apart (CAPTCHA) is a way of differentiating humans and machines and was coined by von Ahn, Blum, Hopper, and Langford <!-- -->[5]<!-- -->. The core idea is that reading distorted letters, numbers, or images is achievable for a human but very hard or impossible for a computer. CAPTCHAs might look like the one below. Most likely the reader has already seen one, when trying to register at a website or write a comment online.</p><p><img loading="lazy" alt="Penguin-Pal_Captcha" src="/assets/images/Penguin-Pal_Captcha-60e20e6ecc315ac8ce937c1ac084ff65.png" width="1548" height="410" class="img_ev3q"></p><p>There are several use cases for CAPTCHAs, which includes the ones presented in <!-- -->[6]<!-- -->: Preventing comment spam, protect website registration, protect e-mail addresses from scrappers, protect online polls, preventing dictionary attacks, and block/hinder search engine bots.</p><p>CAPTCHAs do not give a guarantee that it prevents these cases every time as there are known attack vectors. These include cheap or unwitting human labor, insecure implementation, and machine learning based attacks. We will not go into detail on insecure implementations, as the focus of this article are deep learning based approaches.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="human-based-captcha-breaking">Human-based CAPTCHA breaking<a href="#human-based-captcha-breaking" class="hash-link" aria-label="Direct link to Human-based CAPTCHA breaking" title="Direct link to Human-based CAPTCHA breaking">​</a></h2><p>Out of curiosity and to compare results achieved by machine learning approaches, we take a look at the human based approach. For example <a href="http://bypassCAPTCHA.com/order1.php" target="_blank" rel="noopener noreferrer">BypassCAPTCHA</a> offers breaking CAPTCHAs with cheap human labor in packages (e.g. 20,000 CAPTCHAs for 130$). There are also other services including <a href="http://www.imagetyperz.com/Forms/bypassCAPTCHA.aspx" target="_blank" rel="noopener noreferrer">Image Typerz</a>, <a href="http://expertdecoders.com/" target="_blank" rel="noopener noreferrer">ExpertDecoders</a>, and <a href="https://www.9kw.eu/" target="_blank" rel="noopener noreferrer">9kw.eu</a>. There are also hybrid solutions that use both OCR and human labor like <a href="http://deathbyCAPTCHA.com/user/login" target="_blank" rel="noopener noreferrer">DeathByCAPTCHA</a>. These vendors list the following accuracies and response times (averages):</p><table><thead><tr><th>Service</th><th align="right">Accuracy (daily average)</th><th align="right">Response Time (daily average)</th></tr></thead><tbody><tr><td>BypassCAPTCHA</td><td align="right">N/A</td><td align="right">N/A</td></tr><tr><td>Image Typerz</td><td align="right">95%</td><td align="right">10+ sec</td></tr><tr><td>ExpertDecoders</td><td align="right">85%</td><td align="right">12 sec</td></tr><tr><td>CAPTCHABOSS (premium version of ExpertDecoders)</td><td align="right">99%</td><td align="right">8 sec</td></tr><tr><td>9kw.eu</td><td align="right">N/A</td><td align="right">30 sec</td></tr><tr><td>DeathByCAPTCHA</td><td align="right">96.8%</td><td align="right">10 sec</td></tr></tbody></table><p>The values are advertised and self-reported. We did not conduct any verification of the stated numbers, but it can give an orientation on human performance and serves as a reference for our machine learning algorithms.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="learning-based-captcha-breaking">Learning-based CAPTCHA breaking<a href="#learning-based-captcha-breaking" class="hash-link" aria-label="Direct link to Learning-based CAPTCHA breaking" title="Direct link to Learning-based CAPTCHA breaking">​</a></h2><p>CAPTCHAs are based on unsolved or hard AI problems. However, with the progress of AI techniques and computing power, sequences of characters or CAPTCHAs can be recognized as shown by Goodfellow et al. in <!-- -->[1]<!-- -->, Hong et al. in <!-- -->[2]<!-- -->, Bursztein et al. in <!-- -->[3]<!-- --> and <!-- -->[7]<!-- -->, and Stark et al. in <!-- -->[4]<!-- --> using deep learning techniques. Goodfellow et al. predict numbers from Goolge Street View images directly (without pre-processing) utilizing a CNN. They make use of  <a href="https://research.google.com/pubs/pub40565.html" target="_blank" rel="noopener noreferrer">DistBelief</a> by Dean et al. to scale the learning to multiple computers and to avoid out of memory issues <!-- -->[1]<!-- -->. This technique was later on used to solve CAPTCHAs, whereby the researched achieved an <a href="http://www.zdnet.com/article/google-algorithm-busts-CAPTCHA-with-99-8-percent-accuracy/" target="_blank" rel="noopener noreferrer">accuracy of up to 99.8%</a>. Hong et al. pre-process CAPTCHAs to rotate them and segment the characters. Afterwards they apply a CNN with three convolutional layers and two fully connected layers <!-- -->[2]<!-- -->. Bursztein et al. use pre-processing, segmentation, and recognition techniques (based on KNN) and later on various CNNs to detect CAPTCHAs from multiple websites including Baidu, Wikipedia, reCAPTCHA, and Yahoo <!-- -->[3]<!-- -->,<!-- -->[7]<!-- -->. Stark et al. researched a way of detecting CAPTCHAs with limited testing data. They use a technique called Active Learning to feed the network with new training data, where the added data has a high classification uncertainty, to improve the performance overall <!-- -->[4]<!-- -->. The below table gives an overview of the reported accuracies in the different papers and blog posts.</p><table><thead><tr><th align="right">Researcher</th><th align="right">Dataset</th><th align="right">Technique</th><th align="right">Accuracy (maximum)</th><th align="right">Reference</th></tr></thead><tbody><tr><td align="right">Goodfellow et al.</td><td align="right">Google Street View image files</td><td align="right">CNN with DistBelief</td><td align="right">96%</td><td align="right">[1]</td></tr><tr><td align="right">Hong et al.</td><td align="right">Microsoft CAPTCHAs</td><td align="right">Preprocessing, segementation and CNN</td><td align="right">57%</td><td align="right">[2]</td></tr><tr><td align="right">Stark et al.</td><td align="right">Cool PHP CAPTCHA generated CAPTCHAs</td><td align="right">CNN with Active Deep Learning</td><td align="right">90%</td><td align="right">[4]</td></tr><tr><td align="right">Bursztein et al.</td><td align="right">Baidu, CNN, eBay, ReCAPTCHA, Wikipedia, Yahoo CAPTCHAs</td><td align="right">Reinforcement Learning, k-Nearest Neighbour</td><td align="right">54% (on Baidu)</td><td align="right">[7]</td></tr><tr><td align="right">Bursztein</td><td align="right">Simple CAPTCHA</td><td align="right">CNN</td><td align="right">92%</td><td align="right">[3]</td></tr><tr><td align="right">Bursztein</td><td align="right">Simple CAPTCHA</td><td align="right">RNN</td><td align="right">96%</td><td align="right">[8]</td></tr></tbody></table><h2 class="anchor anchorWithStickyNavbar_LWe7" id="current-state-of-captchas">Current state of CAPTCHAs<a href="#current-state-of-captchas" class="hash-link" aria-label="Direct link to Current state of CAPTCHAs" title="Direct link to Current state of CAPTCHAs">​</a></h2><p>Google has introduced <a href="https://www.google.com/reCAPTCHA/intro/index.html" target="_blank" rel="noopener noreferrer">NoCAPTCHA</a> in December 2014. This introduces multiply new features including evaluation based on cookies, movement of the mouse, and recognition of multiple images. Google announced to introduce an <a href="https://www.google.com/reCAPTCHA/intro/comingsoon/invisiblebeta.html" target="_blank" rel="noopener noreferrer">invisible CAPTCHA</a> to get rid of the checkbox.</p><p><img loading="lazy" src="/assets/images/noCaptcha-mobile.png-1d7af2b0320d64d0f4a7544a418d51ca.gif" width="616" height="164" class="img_ev3q"></p><p>The previous version of <a href="https://security.googleblog.com/2014/12/are-you-robot-introducing-no-CAPTCHA.html" target="_blank" rel="noopener noreferrer">reCAPTCHA</a> was very popular on many websites. It included typically two words with rotation and had an audio option. Further CAPTCHA techniques can include simple logic or math questions, image recognition, recognition of friends (social CAPTCHA), or user interaction (like playing a game) <!-- -->[9]<!-- -->.</p><p><img loading="lazy" src="/assets/images/red-captcha-eb7bbb456e096d15a1a746bb888bf2f3.png" width="319" height="129" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="our-objectives-and-motivation">Our objectives and motivation<a href="#our-objectives-and-motivation" class="hash-link" aria-label="Direct link to Our objectives and motivation" title="Direct link to Our objectives and motivation">​</a></h2><p>The aim of the project is to break CAPTCHAs using deep learning technologies without pre-segmentation. Initially we focus on simple CAPTCHAs to evaluate the performance and move into more complex CAPTCHAs. The training dataset is generated from an open source CAPTCHA generation software. Tensorflow is used to create and train a neural network.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="creating-the-datasets">Creating the datasets<a href="#creating-the-datasets" class="hash-link" aria-label="Direct link to Creating the datasets" title="Direct link to Creating the datasets">​</a></h2><p>We are generating the datasets using a Java based CAPTCHA generator (<a href="http://simpleCAPTCHA.sourceforge.net/" target="_blank" rel="noopener noreferrer">SimpleCAPTCHA</a>). We have created the following datasets.</p><table><thead><tr><th align="left">Description</th><th align="right">Size</th><th align="right">Training samples</th><th align="right">Test samples</th></tr></thead><tbody><tr><td align="left">Digits only</td><td align="right">38 MB</td><td align="right">9502</td><td align="right">100</td></tr><tr><td align="left">Digits and characters</td><td align="right">197 MB</td><td align="right">49796</td><td align="right">100</td></tr><tr><td align="left">Digits and characters with rotation</td><td align="right">39 MB</td><td align="right">10000</td><td align="right">100</td></tr><tr><td align="left">Digits and characters with rotation</td><td align="right">198 MB</td><td align="right">49782</td><td align="right">500</td></tr><tr><td align="left">Digits and characters with rotation</td><td align="right">777 MB</td><td align="right">196926</td><td align="right">500</td></tr></tbody></table><p>Each dataset contains jpeg images containing a CAPTCHA with five characters. The characters are lowercase (a-z) or numbers (0-9). We used the fonts &quot;Arial&quot; and &quot;Courier&quot; with noise. An example of the created CAPTCHAs is displayed below. Our intention was to mimic the CAPTCHAs created by <a href="https://courses.csail.mit.edu/6.857/2015/files/hong-lopezpineda-rajendran-recansens.pdf" target="_blank" rel="noopener noreferrer">Microsoft</a>.
We have extended SimpleCAPTCHA library in order to get character rotation, outlines in CAPTCHAs to achieve the same look of Microsoft CAPTCHAs.</p><p><img loading="lazy" alt="54563" src="data:image/jpeg;base64,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" width="152" height="80" class="img_ev3q">
<img loading="lazy" alt="5p23r" src="data:image/jpeg;base64,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" width="152" height="80" class="img_ev3q">
<img loading="lazy" alt="ycn2m" src="data:image/jpeg;base64,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" width="152" height="80" class="img_ev3q"></p><p>Generated CAPTCHAs will be 152x80 greyscale images. This resolution is chosen because it is small enough to reduce memory footprint when training the CNN and it is also enough to recognize the CAPTCHA easily.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="deep-cnn-model">Deep CNN model<a href="#deep-cnn-model" class="hash-link" aria-label="Direct link to Deep CNN model" title="Direct link to Deep CNN model">​</a></h2><p>Based on the research in <!-- -->[1]<!-- -->, <!-- -->[3]<!-- --> and <!-- -->[4]<!-- --> we use a deep CNN with three ReLU layers and two fully connected layers to solve the CAPTCHAs.
Each digit is represented by 36 neurons in the output layer.
The three convolutional layers with ReLU activation function have the sizes of 32, 64, and 128.
5x5 filter size was used in all layers. After each convolutional layer there is a max pooling of 2.
After the last convolutional layer, there is a fully connected layer with ReLU of size 1024 and finally another fully connected layer that has an output size of 180. In the ReLU layers, a dropout of 0.75 is applied.</p><p>In the output layer, digits 0-9 will be represented by 1 to 10 neurons and, characters a to z will be represented by 11 to 36 neurons. Therefore, there are 5 x 36 neurons which will identify the CAPTCHA. The network will output the predictions for all 5 digits and each digit is calculated by the max probability of its 36 neurons. We have set the learning rate as 0.001.</p><p><img loading="lazy" alt="CNN" src="/assets/images/cnn-70733545e9cb1ac6fb918429a8a46f78.png" width="1103" height="2524" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="results-and-discussion">Results and discussion<a href="#results-and-discussion" class="hash-link" aria-label="Direct link to Results and discussion" title="Direct link to Results and discussion">​</a></h2><p>First, we trained the CNN with 10000 five letter and digit CAPTCHAs without rotation on a GTX660M. We had 100 batches with a batch size of 100 and ran it for 20 epochs. The hyperparameters were set as described in the previous section. The figure below shows that the network did not perform well with these settings. We then increased the training size to 50000 CAPTCHAs, but the results stayed the same. We then tried with 10000 simplified CAPTCHAs with only five digits without rotation. However, this still did not improve our situation. We noted that the loss function reduced quite quickly and stayed constant. We hence introduced another convolutional layer to the network to allow it to further differentiate the digits. Again, this resulted in almost the same result.</p><p><img loading="lazy" alt="DigitsOnly660M" src="data:image/png;base64,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" width="600" height="371" class="img_ev3q"> <br>
<em>CNN with three conv. layers and two fully connected layers accuracy of CAPTCHAs with five digits or lowercase letters without rotation. Training in 100 batches and 10000 training samples.</em></p><p>These results match the ones presented in <!-- -->[4]<!-- -->. The authors then introduce Active Learning to circumvent the problem. In <!-- -->[1]<!-- --> a larger amount of samples is used. However, we do not have sufficient computing power available to use millions of images as training data. Also, in <!-- -->[3]<!-- --> the batch size is larger, resulting in a considerably higher accuracy. We decided to change our batch size, but required a more powerful GPU for that. Hence, we used a Nvidia Tesla K80 from AWS to conduct our training. We also changed the CNN back to three conv. layers and two fully connected layers. On the simple case with five digit CAPTCHAs without rotation we used 39250 CAPTCHAs in 157 batches and 10 epochs. We conducted testing with a very small dataset of 100 CAPTCHAs. The results did improve considerably as shown in the figure below. We managed to achieve a best training error of 94.9% and a test error of 99.2%. The very high test accuracy is quite likely also caused by the small amount of test items. However, running a K80 in AWS is quite costly and therefore we kept the test set to a minimum also in the upcoming experiments.</p><p><img loading="lazy" alt="DigitsOnly" src="data:image/png;base64,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s7eH31itmlis1hxe2GL173tfvVGmYkTJm1im2v/2941CNXF4naGkKWmY1GQms5KQv5KVv4KVK1Zrm3sWtFj9zz/2T1uqvro69EaZir+31xlKGkqaSU1mMltWxWuuK1qFVqz2nBko+NZf/vj5yajXWYkZHh4uiT9DSUNJM6nJTGZL9u+e/xZj/luL9V8OzOmk9/zClb+ClStW/+cv/88LZxm/zmpra0viz1DSUNJMajKTWdkVr/wVrkv3hmd97pXX2fL+3px4T8239WcoaShpJjWZyUzx8jrzvZlXrnIjxA3MDx48mKqrq9OBAwfS69evx557/fr17ObpMd5///107969gn+GkoaSZlJDZouaWf45XsuheHmdySy/qOUcP348/frrr2loaChdvnw5ff7552O/FuXswoULaWRkJF29ejVt3bq14J+hpKGkmdSQ2ZwzW6iT65dC8fI6K73M/vov/7ygYyYlbfPmzVkJC6Ojo+mdd94Z+7U9e/Zkq2x//etf0+Dg4KR/hpLGrHV1daVt27alioqKVF9fnx4+fFjweS9evEgfffRRqqqqSn/605/eeCEqaQ4EMlsacm85/vn+8LiLoa5sfKF4eZ0paZMUrDhG5r99GR/n9PX1pV27dmWfq6ysTJ2dnUoa86OpqSm1tbVl77e3tramxsbGgs/74x//mL7//vusnMVS75dffqmkORDIrATlVsEmlrDZrH6Vc/HyOpNZoYK1cePGaS+nEW+FxnFyw4YNShrzI1bR4qeA0N3dPel24bVr146tnsULsdhtxUqaA4HM5qeE5c7/yt1ncaa3AsoVsNyte3IXQ3U5Ca8zmY0X55r99ttv2eNPP/00/fLLL9nx77vvvks7d+4ce14cD69cuZK9HZrbRFDoz1DSmLV4+zL3Pnu8+GKptpDY0ZL7KeLly5eTPk9JcyCQWWmWsOkulup15ntTZuPFO0u5Y10c9/bv358dM+PUoDhVKOfBgwfZrs7cDs8oaoX+DCWNWVu5cuXY4zgZMv/jieUqdq309vamQ4cOTfo8Jc2BQGalWcK8znxvygwlbYmpqakZWyGLlbT4KaGQZ8+epR07dmQrau3t7Wn16tVFl7T4JjWMchhXOjrTVxd/Tbu+eDrj+zz+5/7eVN3Uk94//izt+/px+q9vHmdvRX537ReZGstioKQxQ3V1damnpyd7/Pz5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" width="617" height="371" class="img_ev3q"> <br>
<em>CNN with three conv. layers and two fully connected layers accuracy of CAPTCHAs with five digits without rotation. Training in 157 batches, 39250 training samples, and testing with 100 CAPTCHAs.</em></p><p>We then tried with a bit more complex CAPTCHAs with digits and lowercase characters. We used 49750 training and 100 test CAPTCHAs with the same CNN used in the simple case above. The figure below presents our results and shows that we can achieve a training accuracy of 65% and a test accuracy above 80% in these cases. We stopped the CNN prematurely after 10 epochs to try more complex use cases.</p><p><img loading="lazy" alt="DigitsChar" src="/assets/images/digits_char-c1b61ca17b60cc87f3a196fd3b5b74b9.png" width="600" height="371" class="img_ev3q"> <br>
<em>CNN with three conv. layers and two fully connected layers accuracy of CAPTCHAs with five digits or lowercase letters without rotation. Training in 199 batches, 49750 training samples, and testing with 500 CAPTCHAs.</em></p><p>Next, we added rotation to our CAPTCHAs and trained the CNN on 49782 samples. This resulted in almost random result with an accuracy around 10%. We thus increased the samples to 196926 and tested it on 500. Again, we kept the same hyperparameters as presented in the model section. This time we trained for 15 epochs, to prevent premature interruption of the training. Our results are presented in the figure below. With the increased training size we achieve a training accuracy of 97.1% and a test accuracy of 99.5%. However, this is again on a very small test set.
<img loading="lazy" alt="DigitsCharRot" src="/assets/images/digits_char_rot-979ed47979feb273521ac958879dc125.png" width="600" height="371" class="img_ev3q"> <br>
<em>CNN with three conv. layers and two fully connected layers accuracy of CAPTCHAs with five digits or lowercase letters with rotation. Training in 787 batches, 196926 training samples, and testing with 500 CAPTCHAs.</em></p><p>From the tests conducted above, we have a few examples to show correct and false predictions.</p><table><thead><tr><th align="left"><strong>Correctly classified</strong></th><th align="left"><strong>Incorrectly classified</strong></th></tr></thead><tbody><tr><td align="left">Prediction: 54563 Image: <img loading="lazy" alt="54563" src="data:image/jpeg;base64,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" width="152" height="80" class="img_ev3q"></td><td align="left">Prediction: 8229<strong>8</strong> Image: <img loading="lazy" alt="82290" src="data:image/jpeg;base64,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" width="152" height="80" class="img_ev3q"></td></tr><tr><td align="left">Prediction: grh56 Image: <img loading="lazy" alt="grh56" src="data:image/jpeg;base64,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" width="152" height="80" class="img_ev3q"></td><td align="left">Prediction: <strong>k</strong>76ap Image: <img loading="lazy" alt="h76ap" src="data:image/jpeg;base64,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" width="152" height="80" class="img_ev3q"></td></tr><tr><td align="left">Prediction: fb2x4 Image: <img loading="lazy" alt="fb2x4" src="data:image/jpeg;base64,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" width="152" height="80" class="img_ev3q"></td><td align="left">Prediction: fffg<strong>r</strong> Image: <img loading="lazy" alt="k76ap" src="data:image/jpeg;base64,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" width="152" height="80" class="img_ev3q"></td></tr></tbody></table><h2 class="anchor anchorWithStickyNavbar_LWe7" id="conclusion">Conclusion<a href="#conclusion" class="hash-link" aria-label="Direct link to Conclusion" title="Direct link to Conclusion">​</a></h2><p>With this project we have shown that it is possible to create large enough datasets automatically to mimic certain CAPTCHAs (i.e. Microsoft). This provides large labeled datasets, which serve as a foundation to train neural networks. We have chosen to use two different CNNs with three and four convolutional layer and two fully connected layers. Our experiments show however, that adding more layers to the network did not increase the accuracy.
We noticed that optimizing a CNN can be cumbersome. While running the CNN on a GTX 660M, we were not able to manage to get satisfying results. Most likely we would have needed more training time on the batches to receive better results. When we switched to a Tesla K80 we managed to train the network with larger amounts of data and a higher batch size. This resulted in higher accuracy on the simple and more complex datasets. We realized that memory poses a quite severe limitation towards applying large scale machine learning.
Our approach based on a CNN is limited to CAPTCHAs with exactly the length defined in the network. Hence, classifying CAPTCHAs with any other length than five would fail. As an alternative a RNN could be used to resolve this issue. In <!-- -->[8]<!-- --> a use of RNN to break CAPTCHAs is discussed with fairly good results. However, also in this approach a powerful GPU is required.
Moreover, using a CNN requires large datasets to be trained on. For a combination of digits, characters, and rotation we required a dataset of around 200000 CAPTCHAs (~780MB). On small sized GPU this datasets cause either out of memory errors or require a quite long training time. Even with the Tesla K80 the training time takes around 2 hours and 30 minutes.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="references">References<a href="#references" class="hash-link" aria-label="Direct link to References" title="Direct link to References">​</a></h2><ol><li>Goodfellow, Ian J., et al. &quot;Multi-digit number recognition from street view imagery using deep convolutional neural networks.&quot; arXiv preprint arXiv:1312.6082 (2013).</li><li>Hong, Colin et al. &quot;Breaking Microsoft’s CAPTCHA.&quot; (2015).</li><li>Using deep learning to break a CAPTCHA system in Deep Learning. 3 Jan. 2016, <a href="https://deepmlblog.wordpress.com/2016/01/03/how-to-break-a-CAPTCHA-system/" target="_blank" rel="noopener noreferrer">https://deepmlblog.wordpress.com/2016/01/03/how-to-break-a-CAPTCHA-system/</a>. Accessed 6 Dec. 2016.</li><li>Stark, Fabian, et al. &quot;CAPTCHA Recognition with Active Deep Learning.&quot; Workshop New Challenges in Neural Computation 2015. 2015.</li><li>Von Ahn, Luis, et al. &quot;CAPTCHA: Using hard AI problems for security.&quot; International Conference on the Theory and Applications of Cryptographic Techniques. Springer Berlin Heidelberg, 2003.</li><li>&quot;CAPTCHA: Telling Humans and Computers Apart Automatically&quot; 2010, <a href="http://www.CAPTCHA.net/" target="_blank" rel="noopener noreferrer">http://www.CAPTCHA.net/</a>. Accessed 7 Jan. 2017.</li><li>Elie Bursztein et al., &quot;The end is nigh: generic solving of text-based CAPTCHAs&quot;. Proceedings of the 8th USENIX conference on Offensive Technologies, p.3-3, August 19, 2014, San Diego, CA</li><li>Recurrent neural networks for decoding CAPTCHAs in Deep Learning. 12 Jan. 2016, <a href="https://deepmlblog.wordpress.com/2016/01/12/recurrent-neural-networks-for-decoding-CAPTCHAs/" target="_blank" rel="noopener noreferrer">https://deepmlblog.wordpress.com/2016/01/12/recurrent-neural-networks-for-decoding-CAPTCHAs/</a>. Accessed 9 Jan. 2017.</li><li>CAPTCHA Alternatives and thoughts. 15 Dec. 2015, <a href="https://www.w3.org/WAI/GL/wiki/CAPTCHA_Alternatives_and_thoughts" target="_blank" rel="noopener noreferrer">https://www.w3.org/WAI/GL/wiki/CAPTCHA_Alternatives_and_thoughts</a>. Accessed 9 Jan. 2017.</li></ol></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/ai">ai</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/deep-learning">deep learning</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/captcha">captcha</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/breaking-captchas">breaking captchas</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/machine-learning">machine learning</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/python">python</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/tensorflow">tensorflow</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/dinvest-hedge-fund-on-a-blockchain">dInvest - hedge fund on a blockchain</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2017-01-10T00:00:00.000Z" itemprop="datePublished">January 10, 2017</time> · <!-- -->4 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://harz.dev" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/nud3l.png" alt="Dominik Harz"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://harz.dev" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Dominik Harz</span></a></div><small class="avatar__subtitle" itemprop="description">CTO Interlay</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>As public reputation becomes one of the most important success factors beyond financial success, investment opportunity should ensure ethical decisions and keep sustainable investment as core of their strategy. These long-term investment strategies based on criteria other than pure financial data are summarized under &quot;Value Investment&quot;. Value investment is based on the assumption that the current price of an asset might not be the actual value of an asset (e.g. stocks and derivatives). Thus, criteria other than their current prices can be taken into account to calculate their value. The value investing approach offers thereby methods to select potential investment based on social or sustainability criteria. Furthermore, value investment includes diversification of the portfolio to achieve a desired level of risk.</p><p>In this blog post I will introduce dInvest, a project <a href="https://se.linkedin.com/in/tharidu-fernando" target="_blank" rel="noopener noreferrer">Tharidu</a> and me are working on. With the development of blockchain technologies and the Ethereum blockchain, an autonomous and decentralized approach can be taken to create an investment opportunity. Users are able to invest directly with the cryptocurrency Ether into a company which exists in the Ethereum blockchain. Alternatively, they can invest with other cryptocurrencies (e.g. Bitcoin) or fiat currencies by utilizing currency exchanges. An autonomous organization build on Smart Contracts exists solely as code and can execute the details as specified in the contract. As an example, The DAO enabled users to act as venture capitalists by suggesting investments to other users. If a certain amount of investments was raised the contracts would be executed inside the blockchain. However, this approach failed as The DAO suffered security flaws, which led to a severe attack on its system. Furthermore, The DAO failed to give incentives to users proposing investments. Investments are voted for two weeks, while a vote can only be given by bounding a user’s capital into the vote. Thus, late voting and waiting for other’s resulted in available capital.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="problem">Problem<a href="#problem" class="hash-link" aria-label="Direct link to Problem" title="Direct link to Problem">​</a></h2><p>Certain investors want to invest their money in order to gain returns while being socially responsible and sustainable to e.g. achieve corporate sustainability objectives. However, financial intermediaries, such as investment banks or hedge funds, do not always adhere to investors’ requirements as there might be conflicting interests. Furthermore, the investment strategy applied by the financial intermediary can change through time and is highly influenced by social factors. In addition to that, investors do not have complete transparency over the transactions.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="our-work">Our work<a href="#our-work" class="hash-link" aria-label="Direct link to Our work" title="Direct link to Our work">​</a></h2><p>We decided to develop an autonomous hedge fund in the Ethereum blockchain. Users are represented in the Ropsten network of the Ethereum blockchain as addresses. Users can hold certain amounts of test Ether, which they can invest into dInvest. The investment will contain an amount of Ether and a time period defined by the user. The details of the investment will be defined in a smart contract between the user and dInvest. Selecting stocks for different investment amounts and time periods is comparably computation intensive and will require the application of investment algorithms. Thus, their executing is costly in the blockchain and will therefore be executed by an autonomous agent (invest agent) outside of the blockchain. The required information will be passed on to dInvest on demand and therefore keeping the operational cost to a minimum.
The invest agent will suggest investment strategies to the hedge fund according to the current Ether value. The hedge fund will decide to approve or reject the offer based on the sustainability criteria of users’ investments. Only if the criteria is fulfilled, the Ether will be transferred to the buy agent and make the investment. The invest agent will transfer the investment return to the hedge fund where the profit/loss will be divided to investors according to their investment value.</p><p>We managed to achieve a linear cost function of user investments and their sustainability criteria in the smart contract. Based on a value investment investment strategy we managed to achieve around 360% increase of the portfolio in a back-testing simulation over around 6 years. The sustainability criteria was implemented using exclusion of assets based on industry codes (i.e. exclusion of defense, alcohol, tobacco, or coal industries).
If you are interested in the academic side and the results of our implementation, you can check out our <a href="https://goo.gl/T74EGE" target="_blank" rel="noopener noreferrer">report</a>.
As the paper does not cover the implementation in detail, I will post the details in separate blog posts and link them here. You can also check out our <a href="/github.com/nud3l/dInvest">source code on GitHub</a>.</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/dinvest">dinvest</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/blockchain">blockchain</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/de-fi">DeFi</a></li></ul></div></footer></article><nav class="pagination-nav" aria-label="Blog list page navigation"></nav></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 Dominik Harz. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.82fdd56c.js"></script>
<script src="/assets/js/main.4f748605.js"></script>
</body>
</html>