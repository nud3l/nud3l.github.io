"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[4153],{5680:(e,t,n)=>{n.d(t,{xA:()=>h,yg:()=>g});var a=n(6540);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var l=a.createContext({}),c=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},h=function(e){var t=c(e.components);return a.createElement(l.Provider,{value:t},e.children)},p="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,l=e.parentName,h=s(e,["components","mdxType","originalType","parentName"]),p=c(n),m=r,g=p["".concat(l,".").concat(m)]||p[m]||u[m]||o;return n?a.createElement(g,i(i({ref:t},h),{},{components:n})):a.createElement(g,i({ref:t},h))}));function g(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,i=new Array(o);i[0]=m;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[p]="string"==typeof e?e:r,i[1]=s;for(var c=2;c<o;c++)i[c]=n[c];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},9227:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>u,frontMatter:()=>o,metadata:()=>s,toc:()=>c});var a=n(8168),r=(n(6540),n(5680));const o={slug:"ethereum-python-integration",title:"Integrating Python and Ethereum",tags:["dinvest","blockchain","ethereum","python"],authors:"dom"},i=void 0,s={permalink:"/blog/ethereum-python-integration",editUrl:"https://github.com/nud3l/nud3l.github.io/blog/2017-02-14-ethereum-python-integration.md",source:"@site/blog/2017-02-14-ethereum-python-integration.md",title:"Integrating Python and Ethereum",description:"In Ethereum and other blockchains there are still a lot of proof of concept implementation and developers trying out how to cope with the new concepts. As part of the dInvest post series I was also looking into Ethereum and trying to implement a hedge fund in a blockchain. In a previous post I discussed how to get a quantitative framework in python up and running. In this post I will write how to integrate python programs with Ethereum smart contracts. For one reason or another you might be also faced with the issue, that although Ethereum offers a Turing-complete language not everything is actually doable there.",date:"2017-02-14T00:00:00.000Z",formattedDate:"February 14, 2017",tags:[{label:"dinvest",permalink:"/blog/tags/dinvest"},{label:"blockchain",permalink:"/blog/tags/blockchain"},{label:"ethereum",permalink:"/blog/tags/ethereum"},{label:"python",permalink:"/blog/tags/python"}],readingTime:4.61,hasTruncateMarker:!1,authors:[{name:"Dominik Harz",title:"CTO Interlay",url:"https://harz.dev",imageURL:"https://github.com/nud3l.png",key:"dom"}],frontMatter:{slug:"ethereum-python-integration",title:"Integrating Python and Ethereum",tags:["dinvest","blockchain","ethereum","python"],authors:"dom"},prevItem:{title:"Analyzing Bitcoin smart contracts from a mechanism design perspective",permalink:"/blog/bitcoin-smart-contracts-mechanism-design"},nextItem:{title:"Quantitative finance with zipline",permalink:"/blog/quantitative-finance-zipline"}},l={authorsImageUrls:[void 0]},c=[{value:"dInvest smart contract",id:"dinvest-smart-contract",level:2},{value:"Interaction with smart contracts",id:"interaction-with-smart-contracts",level:2},{value:"Getting your ABI",id:"getting-your-abi",level:2},{value:"Setting up the RPC provider",id:"setting-up-the-rpc-provider",level:2},{value:"Interacting with the smart contract",id:"interacting-with-the-smart-contract",level:2},{value:"Final note",id:"final-note",level:2}],h={toc:c},p="wrapper";function u(e){let{components:t,...n}=e;return(0,r.yg)(p,(0,a.A)({},h,n,{components:t,mdxType:"MDXLayout"}),(0,r.yg)("p",null,"In Ethereum and other blockchains there are still a lot of proof of concept implementation and developers trying out how to cope with the new concepts. As part of the dInvest post series I was also looking into Ethereum and trying to implement a hedge fund in a blockchain. In a previous post I discussed how to get a quantitative framework in python up and running. In this post I will write how to integrate python programs with Ethereum smart contracts. For one reason or another you might be also faced with the issue, that although Ethereum offers a Turing-complete language not everything is actually doable there."),(0,r.yg)("p",null,"Let's say you have created one of the ",(0,r.yg)("a",{parentName:"p",href:"www.ethereum.org/greeter"},"simple tutorial contracts in Ethereum")," and now want to look at something more advanced. I personally liked the ",(0,r.yg)("a",{parentName:"p",href:"https://medium.com/zeppelin-blog/the-hitchhikers-guide-to-smart-contracts-in-ethereum-848f08001f05##.3dxx4rysl"},"Hitchhiker's Guide to Smart Contracts")," by Manuel Ar\xe1oz to get started with more complex code, setup testrpc, and truffle. Take a look at it."),(0,r.yg)("h2",{id:"dinvest-smart-contract"},"dInvest smart contract"),(0,r.yg)("p",null,"dInvest is composed of one smart contract that is responsible for making investments, verifying investment\ncriteria and distribution of returns. The contract exposes public functions to create new investments and\nfor withdrawal which will act as main functions of a hedge fund. Users of the hedge fund are identified\nby their Ethereum address which is equivalent for the public key. Suggestion of investment strategies and\nstrategy execution are done in different agents that also have Ethereum addresses. These agents are set by\nthe contract creator only.\nWhen a user is creating an investment it is possible to specify a list of industry sectors identified by a\ntwo digit number based on the Standard Industrial Classification codes. These sectors will be identified\nas a black list when making the investments. Therefore user have the ability control the sectors which the\nhedge fund will invest on."),(0,r.yg)("p",null,"The contract can be found in ",(0,r.yg)("a",{parentName:"p",href:"github.com/nud3l/dInvest/blob/master/solidity/contracts/HedgeContract1.sol"},"the GitHub repo"),"."),(0,r.yg)("h2",{id:"interaction-with-smart-contracts"},"Interaction with smart contracts"),(0,r.yg)("p",null,"To interact with smart contracts, there are a couple of option including RPC or a JavaScript API. I found the easiest way to interact with Ethereum smart contracts from other programs (like python programs) was using their ",(0,r.yg)("a",{parentName:"p",href:"github.com/ethereum/wiki/wiki/JavaScript-API"},"web3 JavaScript API"),". As the majority of dInvest is written in python, I wanted to stick to the language and not include JS as well. Luckily, there is a ",(0,r.yg)("a",{parentName:"p",href:"github.com/pipermerriam/web3.py"},"web3 implementation in python"),". To get it up and running for the dInvest setting I switched to the virtualenv, where I also installed zipline and then install web3 simply with ",(0,r.yg)("inlineCode",{parentName:"p"},"pip install web3"),"."),(0,r.yg)("p",null,"Using web3, there are three steps to get you up and running to interact with your smart contract:"),(0,r.yg)("ol",null,(0,r.yg)("li",{parentName:"ol"},"Getting your ABI"),(0,r.yg)("li",{parentName:"ol"},"Setup the RPC connection"),(0,r.yg)("li",{parentName:"ol"},"Interact with the smart contract")),(0,r.yg)("p",null,"In the next sections, I will go into detail how to achieve the three steps. I am using this mostly as a python module for other programs. In the end our python module structure might look like this:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre"},"contract\n|-- __init__.py\n|-- ContractHandler.py\n|-- your-contract-name.json\n")),(0,r.yg)("h2",{id:"getting-your-abi"},"Getting your ABI"),(0,r.yg)("p",null,"Now, to interact with any smart contract you need the ",(0,r.yg)("a",{parentName:"p",href:"github.com/ethereum/wiki/wiki/Ethereum-Contract-ABI"},"Application Binary Interface(ABI)")," defined by the contract. The ABI is a static, strongly typed interface. Whenever you create a new contract or change an existing one, chances are your ABI changes as well. In my experience the easiest way to get the current ABI of a smart contract (which might be yours or any contract you have the source code available) is to go to ",(0,r.yg)("a",{parentName:"p",href:"https://ethereum.github.io/browser-solidity/"},"https://ethereum.github.io/browser-solidity/"),' and copy/paste your code there. Then press the "Compile" button on the upper right side and copy the entire string in the "Interface" field into a ',(0,r.yg)("inlineCode",{parentName:"p"},"your-contract-name.json")," file. Once you have that JSON, your web3 interface will know how to interact with the contract."),(0,r.yg)("h2",{id:"setting-up-the-rpc-provider"},"Setting up the RPC provider"),(0,r.yg)("p",null,"As a next step you will need to connect to the RPC provider. In your python file (e.g. ",(0,r.yg)("inlineCode",{parentName:"p"},"ContractHandler.py"),") include those lines of code:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-python"},"from web3 import Web3, TestRPCProvider\n\nclass ContractHandler:\n  def __init__(self):\n    self.web3 = Web3(RPCProvider(host='localhost', port='8545'))\n    with open(str(path.join(dir_path, 'contract_abi.json')), 'r') as abi_definition:\n      self.abi = json.load(abi_definition)\n    self.contract_address = your_contract_address\n    self.contract = self.web3.eth.contract(self.abi, self.contract_address)\n")),(0,r.yg)("p",null,"I prefer having my configurations in a separate file. There are many ways to do it and it seems like there is no standard in python. I guess using a txt file is not the best option though and I plan to switch to yml soon. See also here ",(0,r.yg)("a",{parentName:"p",href:"https://martin-thoma.com/configuration-files-in-python/"},"https://martin-thoma.com/configuration-files-in-python/"),". Make sure to run your favorite Ethereum client before starting your program (e.g. ",(0,r.yg)("inlineCode",{parentName:"p"},"geth --rpc"),")."),(0,r.yg)("h2",{id:"interacting-with-the-smart-contract"},"Interacting with the smart contract"),(0,r.yg)("p",null,"Note: Before interacting with your own account you need to unlock it first. This is achieved in web3 via:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-python"},"self.web3.personal.unlockAccount(your_ethereum_account, your_ethereum_password)\n")),(0,r.yg)("p",null,"There are some standard web3 calls you can make, like getting the current balance of an account in wei:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-python"},"wei_balance = self.web3.eth.getBalance(some_ethereum_address)\n")),(0,r.yg)("p",null,"In case you want to call a function in the contract you can do this by calling the command as defined by the contract ABI. In our dInvest example there is a contract call which returns the blacklisted companies for our sustainable investment. It is callable with:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-python"},"blacklist = self.contract.call().blackListCompanies()\n")),(0,r.yg)("p",null,"There are some more examples in the ",(0,r.yg)("a",{parentName:"p",href:"https://github.com/nud3l/dInvest/blob/master/trading/contract/ContractHandler.py"},"GitHub code available"),"."),(0,r.yg)("h2",{id:"final-note"},"Final note"),(0,r.yg)("p",null,"As a final note, I would like to point out that there are other blockchain solutions like ",(0,r.yg)("a",{parentName:"p",href:"hyperledger-fabric.readthedocs.io/en/latest/"},"Hyperledger Fabric")," or ",(0,r.yg)("a",{parentName:"p",href:"tendermint.com"},"Tendermint")," that aim to solve issues around compatibility with other programming language, transaction throughput etc. As they are permissioned blockchains I haven't yet given them a try, but might be interesting to take a look at."))}u.isMDXComponent=!0}}]);